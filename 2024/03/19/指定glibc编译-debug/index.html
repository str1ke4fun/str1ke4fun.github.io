<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>指定glibc编译&amp;&amp;debug | str1k3</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('/img/bg.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/links/"><span class="navItemTitle">Links</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>指定glibc编译&amp;&amp;debug</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2024-03-19T09:03:20.000Z" id="date"> 2024-03-19</time></div></span><br><span>Last Update: <div class="control"><time datetime="2024-03-20T08:11:21.064Z" id="updated"> 2024-03-20</time></div></span></div></div><hr><div id="post-content"><p>之前一直都用海量的虚拟机解决编译等问题<br>如图:)<br class='item-img' data-src='/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/vm.png'><img src="/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/vm.png"><br><br>学到现在发现不是LTS版本的ubuntu维护起来极其麻烦</p>
<p>以下实现一虚拟机下使用不同版本glibc</p>
<p>首先先下载源码<a target="_blank" rel="noopener" href="https://ftp.gnu.org/gnu/glibc/">https://ftp.gnu.org/gnu/glibc/</a></p>
<p>之后解压到目录下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar zxvf glibc-2.32.tar.gz<br></code></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;以下：~&#x2F;Desktop&#x2F;glibc-2.32&#x2F;glibc-2.32 &#x3D; &#x2F;path&#x2F;to&#x2F;your&#x2F;libc</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> build<br><span class="hljs-built_in">cd</span> build<br>~/Desktop/glibc-2.32/glibc-2.32/configure --build=x86_64-pc-linux-gnu --prefix=<span class="hljs-variable">$HOME</span>/Desktop/glibc-2.32/build<br>make -j4<br>make install<br></code></pre></td></tr></table></figure>
<p>这里configure的时候可能会提示需要某些依赖或者软件，根据提示信息下载就行<br>比如我这里提示缺少gawk<br><br class='item-img' data-src='/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/error.png'><img src="/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/error.png"><br><br>那么就</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo apt install gawk<br></code></pre></td></tr></table></figure>

<p>make时间较长，不报错就行</p>
<p><strong>这里有一点需要注意</strong><br>貌似make成功与否与gcc版本有关系，如下是我的尝试信息<br>成功<br class='item-img' data-src='/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/gcc.png'><img src="/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/gcc.png"><br><br>失败<br class='item-img' data-src='/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/gccerr.png'><img src="/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/gccerr.png"><br><br>20.04可行 22.04不可行，猜测为低版本gcc能编译高版本glibc源码 <em>待测试</em></p>
<p>成功走完这里能用了<br>gcc编译示例。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">gcc -Wl,-rpath,~/Desktop/glibc-2.32/glibc-2.32 kiwi.c -o k1w1 -static -z noexecstack -fstack-protector-all -pie -z now -masm=intel<br></code></pre></td></tr></table></figure>

<p>若要在gdb中启用，则需要进入gdb后手动指定，如下<br class='item-img' data-src='/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/gdb.png'><img src="/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/gdb.png"><br><br>若使用pwntools脚本启动，则在启动时如下使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = process([<span class="hljs-string">&quot;/home/str1k3/Desktop/glibc-2.32/elf/ld.so&quot;</span>,<span class="hljs-string">&quot;./k1w1&quot;</span>],env=&#123;<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>:<span class="hljs-string">&quot;/home/str1k3/Desktop/glibc-2.32/libc.so.6&quot;</span>&#125;)<br></code></pre></td></tr></table></figure>

<p>可以使用xclibc项目来切换运行libc环境，以下来自项目的README：<br>这个脚本是基于最新版的<a target="_blank" rel="noopener" href="https://github.com/matrix1001/glibc-all-in-one">glibc-all-in-one</a>，我建议你将其安装到<code>~</code>目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/matrix1001/glibc-all-in-one<br><span class="hljs-built_in">cd</span> glibc-all-in-one<br>./update_list<br></code></pre></td></tr></table></figure>

<p>xclibc脚本配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/ef4tless/xclibc.git<br><span class="hljs-built_in">cd</span> xclibc<br>sudo <span class="hljs-built_in">rm</span> /usr/local/bin/xclibc<br>sudo <span class="hljs-built_in">mv</span> ./xclibc /usr/local/bin<br>sudo <span class="hljs-built_in">chmod</span> +x /usr/local/bin/xclibc<br></code></pre></td></tr></table></figure>

<p>本地libc库部署(*可选)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">xclibc -d all<br>xclibc -d old<br></code></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">xclibc [选项] [参数]<br>-s [libc文件] <span class="hljs-comment"># 查看libc文件版本</span><br>-x [-n] [文件] [libc文件] <span class="hljs-comment"># 一键给文件配置libc文件相应版本的环境（添加-n选项可以使用修改--replace-needed的方式实现）</span><br>-c [-n] [文件] [libc大版本号] [libc小版本环境路径] <span class="hljs-comment"># 给文件配置指定的libc环境，输入大版本号后回车，可自由选择复制libc小版本环境路径（添加-n选项可以使用修改--replace-needed的方式实现）</span><br>-d &lt;-r/-u&gt; [version]/[all]/[old]<br><span class="hljs-comment">#  -d [ENTER] 可以查看所有可下载的libc版本</span><br><span class="hljs-comment">#  -d -r [version] 删除相应的libc版本库</span><br><span class="hljs-comment">#  -d -u 更新glibc-all-in-one libc版本列表(即清华源上有的libc版本列表)</span><br><span class="hljs-comment">#  -d all 下载所有源上有的libc版本</span><br><span class="hljs-comment">#  -d [version] 下载对应版本的libc</span><br>-e [deb包] <span class="hljs-comment"># 解压相应的libc_deb包至glibc_all_in_one路径，通常一个版本需要解压一份本体deb和一份debug_deb包</span><br>-r [文件] <span class="hljs-comment"># 恢复修改过的文件至初始状态</span><br>-h <span class="hljs-comment"># 展示帮助提示</span><br>-v <span class="hljs-comment"># 显示版本号</span><br></code></pre></td></tr></table></figure>
<p>好用爱用<br class='item-img' data-src='/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/xclibc.png'><img src="/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/xclibc.png"><br>xclibc能下载到的东西比glibc-all-in-one多，大赞<br class='item-img' data-src='/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/xclibc-d.png'><img src="/2024/03/19/%E6%8C%87%E5%AE%9Aglibc%E7%BC%96%E8%AF%91-debug/xclibc-d.png"><br></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2024/03/22/%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%90%AD%E5%BB%BA/">← Next 交叉编译环境的搭建</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2024/03/15/MyS3andB0x/">MyS3andB0x Prev →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/faction/4.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://str1ke4fun.github.io/">str1k3</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">使用</span></a></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>